<!DOCTYPE html>
<!--
 | Generated by Apache Maven Doxia Site Renderer 1.8 at 2019-10-17 
 | Rendered using Apache Maven Fluido Skin 1.6
-->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="Date-Revision-yyyymmdd" content="20191017" />
    <meta http-equiv="Content-Language" content="en" />
    <title>Fact Tools &#x2013; Reading and Writing Data</title>
    <link rel="stylesheet" href="./css/apache-maven-fluido-1.6.min.css" />
    <link rel="stylesheet" href="./css/site.css" />
    <link rel="stylesheet" href="./css/print.css" media="print" />
      <script type="text/javascript" src="./js/apache-maven-fluido-1.6.min.js"></script>
      </head>
    <body class="topBarDisabled">
      <div class="container-fluid">
      <div id="banner">
        <div class="pull-left"><a href="http://www.uni-dortmund.de/" id="bannerLeft"><img src="images/logo_tu.png"  alt="tu logo"/></a></div>
        <div class="pull-right"><a href="./" id="bannerRight"><img src="images/header-bg-topLeft.png"  alt="ls8 logo"/></a></div>
        <div class="clear"><hr/></div>
      </div>

      <div id="breadcrumbs">
        <ul class="breadcrumb">
        <li id="publishDate">Last Published: 2019-10-17<span class="divider">|</span>
</li>
          <li id="projectVersion">Version: 1.1.3</li>
        </ul>
      </div>
      <div class="row-fluid">
        <div id="leftColumn" class="span2">
          <div class="well sidebar-nav">
<ul class="nav nav-list">
            <li class="nav-header">General</li>
    <li><a href="index.html" title="Overview"><span class="none"></span>Overview</a>  </li>
    <li><a href="publications.html" title="Publications"><span class="none"></span>Publications</a>  </li>
    <li><a href="viewer.html" title="Fact Viewer"><span class="none"></span>Fact Viewer</a>  </li>
    <li><a href="build.html" title="Building"><span class="none"></span>Building</a>  </li>
          <li class="nav-header">Tutorial</li>
    <li><a href="tutorial/index.html" title="FACT Tools Tutorial"><span class="icon-chevron-right"></span>FACT Tools Tutorial</a>  </li>
          <li class="nav-header">Documentation</li>
    <li><a href="quickstart.html" title="Quickstart"><span class="none"></span>Quickstart</a>  </li>
    <li><a href="multistream.html" title="Using Multistreams"><span class="none"></span>Using Multistreams</a>  </li>
    <li><a href="aux.html" title="Using Auxiliary Data"><span class="none"></span>Using Auxiliary Data</a>  </li>
    <li><a href="stdAnalysis/standardAnalysis.html" title="Standard Analysis"><span class="icon-chevron-down"></span>Standard Analysis</a>
      <ul class="nav nav-list">
    <li><a href="stdAnalysis/standardSettings.html" title="Standard Settings"><span class="none"></span>Standard Settings</a>  </li>
      </ul>
  </li>
    <li><a href="examples.html" title="Usage Examples"><span class="icon-chevron-down"></span>Usage Examples</a>
      <ul class="nav nav-list">
    <li class="active"><a href="#"><span class="none"></span>Reading and Writing Data</a>
  </li>
    <li><a href="plotting/example_plots.html" title="Plotting Data"><span class="icon-chevron-right"></span>Plotting Data</a>  </li>
      </ul>
  </li>
    <li><a href="programming_examples/programming_example.html" title="Programming Examples"><span class="icon-chevron-right"></span>Programming Examples</a>  </li>
    <li><a href="resources.html" title="Further Resources"><span class="none"></span>Further Resources</a>  </li>
          <li class="nav-header">Download</li>
    <li><a href="download.html" title="Download"><span class="none"></span>Download</a>  </li>
          <li class="nav-header">Project Documentation</li>
    <li><a href="project-info.html" title="Project Information"><span class="icon-chevron-right"></span>Project Information</a>  </li>
    <li><a href="project-reports.html" title="Project Reports"><span class="icon-chevron-right"></span>Project Reports</a>  </li>
  </ul>
          <hr />
          <div id="poweredBy">
              <div class="clear"></div>
              <div class="clear"></div>
              <div class="clear"></div>
              <div class="clear"></div>
  <a href="http://maven.apache.org/" title="Built by Maven" class="poweredBy"><img class="builtBy" alt="Built by Maven" src="./images/logos/maven-feather.png" /></a>
              </div>
          </div>
        </div>
        <div id="bodyColumn"  class="span10" >
<h1>Reading and Writing Data</h1>
<p>The essential thing your program usually does is reading and writing of data. In our case we often read raw data from the telescope and perform various steps to reduce all the data to simple parameters which may or may not be relevant for a semantic analysis of the things your experiment recorded.</p>
<div class="section">
<div class="section">
<h3><a name="Writing_complete_Events_to_a_File"></a>Writing complete Events to a File</h3>
<p>A simple example can be given by a process that reads FACT data from a FITS file, applies the DRS calibration and writes out the <tt>DataCalibrated</tt> part, i.e. the calibrated data, into a file in binary form.</p>

<div>
<div>
<pre class="source"> &lt;container&gt;

    &lt;stream id=&quot;fact-data&quot; class=&quot;fact.io.FactEventStream&quot;
            url=&quot;file:///tmp/fact-data.fits.gz&quot; /&gt;


    &lt;process input=&quot;fact-data&quot;&gt;
      
        &lt;fact.datacorrection.DrsCalibration url=&quot;file:///tmp/fact.drs.fits.gz&quot;
                                      key=&quot;data&quot; outputKey=&quot;DataCalibrated&quot;/&gt;

        &lt;fact.io.BinaryFactWriter key=&quot;DataCalibrated&quot;
                                  file=&quot;calibrated-events.dat&quot; /&gt;
        
    &lt;/process&gt;

 &lt;/container&gt;
</pre></div></div>
</div>
<div class="section">
<h3><a name="Writing_keys_to_a_file"></a>Writing keys to a file</h3>
<p>While this might not seem very useful heres another example. Here we write out a calculated feature for each event in the data stream. Lets say we use the <tt>MaxAmplitude</tt> processor to calculate the maximum amplitude for each pixel in each event. You&#x2019;re probably interested in the mean value of <tt>MaxAmplitude</tt> for each event (i.e.  you want the average over all 1440 pixel in each event). To calculate the mean from an array you can use the <tt>ArrayMean</tt> processor in the fact.statistics package. The following example for a simple .xml file does just that and writes the result to a file called <tt>output.csv</tt></p>

<div>
<div>
<pre class="source"> &lt;container&gt;

    &lt;Stream id=&quot;fact-data&quot; class=&quot;fact.io.FITSStream&quot;
            url=&quot;file:///tmp/fact-data.fits.gz&quot; /&gt;


    &lt;Process input=&quot;fact-data&quot;&gt;
      
        &lt;fact.datacorrection.DrsCalibration url=&quot;file:///tmp/fact.drs.fits.gz&quot;
                                      key=&quot;data&quot; outputKey=&quot;DataCalibrated&quot;/&gt;
    
        &lt;fact.features.MaxAmplitude key=&quot;DataCalibrated&quot; outputKey=&quot;maxAmplitude&quot;/&gt;

        &lt;fact.statistics.ArrayMean key=&quot;maxAmplitude&quot; outputKey=&quot;maxAmplitudeMean&quot; /&gt;
        
        &lt;stream.io.CsvWriter keys=&quot;maxAmplitudeMean&quot; url=&quot;file:///tmp/output.csv&quot; /&gt;
    &lt;/Process&gt;
 &lt;/container&gt;
</pre></div></div>

<p>Heres the output in the output.csv file:</p>

<div>
<div>
<pre class="source">E5b-Mac-mini-002:~ kaibrugge$ cat /tmp/output.csv
    maxAmplitudeMean
    17.614393739392597
    14.588448515241033
    22.169573771009336
    14.296095578926428
    21.037508170910385
    125.59263993996835
    16.84055010006866
    15.485890265286749
...
</pre></div></div>

<p>Since you probably want to write out something to connect these numbers to events, you could also write out the event number of each event like so:</p>

<div>
<div>
<pre class="source">&lt;-- No spaces between keys--/&gt;    
&lt;stream.io.CsvWriter keys=&quot;EventNum,maxAmplitudeMean&quot; url=&quot;file:///tmp/output.csv&quot; /&gt;
</pre></div></div>

<p>The output in the file will look accordingly:</p>

<div>
<div>
<pre class="source">E5b-Mac-mini-002:~ kaibrugge$ cat /tmp/output.csv
    EventNum,maxAmplitudeMean
    71,17.614393739392597
    74,14.588448515241033
    75,22.169573771009336
    76,14.296095578926428
    77,21.037508170910385
    78,125.59263993996835
    80,16.84055010006866
    81,15.485890265286749
  ...
</pre></div></div>

<p>Now let&#x2019;s play pretend and say you want to write an object of a custom class to your output file. All the stream.io.CsvWriter does is call the <tt>toString()</tt> method of the java object its trying to print.  You&#x2019;re set as long as you override the <tt>toString()</tt> method yourself. Theres is one catch however. If you want to write out an array to the file the output will look a little something like this:</p>

<div>
<div>
<pre class="source">E5b-Mac-mini-002:~ kaibrugge$ cat /tmp/output.csv
	positionArray
	[I@3acafb56
	[I@786c730
	[I@45d6a56e
	[I@207f5580
	[I@75982fc1
	[I@5a676437
	[I@6855a338
	[I@4e4ee70b
	[I@1e22ab57
  ...
</pre></div></div>

<p>Thats because the .csv format does not initially support data types other than simple numbers or strings. For output of more complex data types you could use the JSONWriter.</p>

<div>
<div>
<pre class="source">&lt;stream.io.JSONWriter keys=&quot;EventNum,maxAmplitudeMean,some_data_structure&quot; url=&quot;file:///tmp/output.json&quot; /&gt;
</pre></div></div></div></div>
        </div>
      </div>
    </div>
    <hr/>
    <footer>
      <div class="container-fluid">
        <div class="row-fluid">
            <p>Copyright &copy;2019.
All rights reserved.</p>
        </div>
        </div>
    </footer>
    </body>
</html>
