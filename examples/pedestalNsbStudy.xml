<container>
    <property name="fhgfs" 		value="/net/home.e5.physik.tu-dortmund.de/vol/ph_e5v/e5b/homes/jbuss/e5/fhgfs" />
    <property name="infile" value="${fhgfs}/groups/app/fact/raw/2013/10/02/20131002_089.fits.gz" />
    <property name="drsfile" value="${fhgfs}/groups/app/fact/raw/2013/10/02/20131002_112.drs.fits.gz" />
    <property name="drstimefile" value="${fhgfs}/groups/app/fact/raw/2013/10/02/20131002_114.drs.time.fits" />
    <property name="outfile" value="/net/home.e5.physik.tu-dortmund.de/vol/ph_e5v/e5b/homes/jbuss/testoutfile.json" />

    <!-- Name des Streams und pfad zu dem Daten-File -->
    <stream id="fact" class="fact.io.FitsStream"  url="file:${infile}"/>

    <property name="skipFirst" value="35" />
    <property name="skipLast"  value="100" />
    <property name="searchWindowSize"  value="100" />


    <!-- Beschreibung des zu bearbeitenden Prozesses und zu welchem Stream dieser gehÃ¶rt -->
    <process id="2" input="fact">
        <fact.utils.PreviousEventInfo startCellKey="StartCellData" outputKey="prevEvents" limitEvents="20"/>
        <stream.flow.Skip condition="%{data.TriggerType} != 1024" />

        <fact.filter.DrsCalibration url="file:${drsfile}"
                                    key="Data"
                                    outputKey="DataCalibrated" />

        <fact.datacorrection.PatchJumpRemoval dataKey="DataCalibrated"
                                              outputKey="DataCalibrated"
                                              prevEventsKey="prevEvents"
                                              startCellKey="StartCellData"
                                              jumpLimit="2.0" />

        <fact.datacorrection.RemoveSpikes dataKey="DataCalibrated"
                                          outputKey="DataCalibrated"
                                          startCellKey="StartCellData"
                                          leftBorder="6"
                                          spikeLimit="20"
                                          topSlopeLimit="16"
                                          maxSpikeLength="4"/>

        <fact.filter.DrsTimeCalibration url="file:${drstimefile}"
                                        drsTimeKey="SamplingTimeDeviation"
                                        outputKey="timeCalibConst"/>

        <fact.filter.ArrayTimeCorrection dataKey="DataCalibrated"
                                         timeCalibConstKey="timeCalibConst"
                                         outputKey="DataCalibrated" />

        <fact.datacorrection.InterpolateBadPixel key="DataCalibrated"  outputKey="DataCalibrated"
                                                 badChidIds="863,868,297,927,80,873,1093,1094,527,528,721,722" />

        <fact.filter.MovingAverage key="DataCalibrated"
                                   outputKey="DataSmoothed"
                                   length="5" />

        <fact.statistics.TimerowFeatures dataKey="DataCalibrated"
                                         movingAverageKey="DataSmoothed"
                                         searchWindowLeft="35"
                                         searchWindowRight="200"
                                         outputKey="voltages" />

        <fact.extraction.ChargeRandSampleGivenWindow key="DataCalibrated"
                                                     outputKey="PedIntegral"
                                                     skipFirst="${skipFirst}"
                                                     skipLast="${skipLast}"
                                                     windowSize="${searchWindowSize}" />

        <fact.statistics.Derivation key="DataSmoothed"
                                    outputKey="slopeKey" />

        <fact.features.singlePulse.ArrivalTimeFromSlope key="DataSmoothed"
                                                        outputKey="arrivalTimes"
                                                        derivationKey="slopeKey"
                                                        visualizeKey="arrivalTimesVisual"
                                                        baselineKey="baselines"
                                                        skipFirstSlices="${skipFirst}"
                                                        skipLastSlices="${skipLast}"/>

        <fact.features.singlePulse.FindMaxSlope key="DataCalibrated"
                                                derivationKey="slopeKey"
                                                outputKey="maxSlopes"
                                                outputKeyVisualization="maxSlopePos"
                                                arrivalTimeKey="arrivalTimes"
                                                maxSearchSlice="${searchWindowSize}"
                                                numFitSlices="8"/>

        <fact.extraction.MinAmplitudeGlobal key="DataCalibrated"
                                            skipFirstSlices="${skipFirst}"
                                            skipLastSlices="${skipLast}"
                                            outputKey="globalMin"/>


        <!--<fact.plotter.HistogramArrayPlotter key="PedIntegral_sum" binWidth="1" logAxis="true" color="#666699" />-->
        <!--<fact.plotter.HistogramArrayPlotter key="PedIntegral_kurtosis" binWidth="1" logAxis="true" color="#666699" />-->
        <!--<fact.plotter.HistogramArrayPlotter key="PedIntegral_skewness" binWidth="1" logAxis="true" color="#666699" />-->
        <!--<fact.plotter.HistogramArrayPlotter key="PedIntegral_min" binWidth="1" logAxis="true" color="#666699" />-->
        <!--<fact.plotter.HistogramArrayPlotter key="PedIntegral_max" binWidth="1" logAxis="true" color="#666699" />-->
        <!--<fact.plotter.HistogramArrayPlotter key="PedIntegral_mean" binWidth="1" logAxis="true" color="#666699" />-->
        <!--<fact.plotter.HistogramArrayPlotter key="PedIntegral_median" binWidth="1" logAxis="true" color="#666699" />-->

        <!--<fact.plotter.HistogramArrayPlotter key="voltages_mean" binWidth="1" logAxis="true" color="#666699" />-->
        <!--<fact.plotter.HistogramArrayPlotter key="voltages_median" binWidth="1" logAxis="true" color="#666699" />-->
        <!--<fact.plotter.HistogramArrayPlotter key="voltages_kurtosis" binWidth="1" logAxis="true" color="#666699" />-->
        <!--<fact.plotter.HistogramArrayPlotter key="voltages_skewness" binWidth="1" logAxis="true" color="#666699" />-->

        <!--<fact.plotter.HistogramArrayPlotter key="baselines" binWidth="1" logAxis="true" color="#666699" />-->
        <!--<fact.plotter.HistogramArrayPlotter key="maxSlopes" binWidth="1" logAxis="true" color="#666699" />-->
        <!--<fact.plotter.HistogramArrayPlotter key="globalMin" binWidth="1" logAxis="true" color="#666699" />-->
        <!--<fact.plotter.HistogramArrayPlotter key="voltages_min" binWidth="1" logAxis="true" color="#666699" />-->

        <!--<fact.ShowViewer key="DataCalibrated"/>-->
        <PrintData/>
        <fact.io.JSONWriter url="file:${outfile}" keys="NIGHT,RUNID,RUNTYPE,MJDREF,PedIntegral,PedIntegral_min,PedIntegral_max,PedIntegral_sum,PedIntegral_median,PedIntegral_mean,PedIntegral_var,PedIntegral_skewness,PedIntegral_kurtosis,globalMin,arrivalTimes,baselines,maxSlopes,voltages_mean,voltages_median,voltages_mode,voltages_std,voltages_kurtosis,voltages_skewness,voltages_min,voltages_max"/>




    </process>


</container>
