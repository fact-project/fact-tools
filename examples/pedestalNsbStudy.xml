<container>

    <properties url="classpath:/default/settings.properties" />

<!--     <property name="fhgfs" 		value="/net/home.e5.physik.tu-dortmund.de/vol/ph_e5v/e5b/homes/jbuss/e5/fhgfs" />
    <property name="infile" value="file:${fhgfs}/groups/app/fact/raw/2013/10/02/20131002_089.fits.gz" />
    <property name="drsfile" value="file:${fhgfs}/groups/app/fact/raw/2013/10/02/20131002_112.drs.fits.gz" /> -->

    <property name="infile" value="file:src/main/resources/testDataFile.fits.gz" />
    <property name="drsfile" value="file:src/main/resources/testDrsFile.drs.fits.gz" />

    <property name="outfile" value="/net/home.e5.physik.tu-dortmund.de/vol/ph_e5v/e5b/homes/jbuss/testoutfile.json" />

    <service id="calibService" class="fact.calibrationservice.ConstantCalibService" />
    
    <!-- Name des Streams und pfad zu dem Daten-File -->
    <stream id="fact" class="fact.io.FitsStream"  url="${infile}"/>

    <property name="skipFirst" value="35" />
    <property name="skipLast"  value="100" />
    <property name="searchWindowSize"  value="100" />


    <!-- Beschreibung des zu bearbeitenden Prozesses und zu welchem Stream dieser gehÃ¶rt -->
    <process id="2" input="fact">
        <fact.utils.PreviousEventInfo startCellKey="StartCellData" outputKey="prevEvents" limitEvents="20"/>
        <stream.flow.Skip condition="%{data.TriggerType} != 1024" />

        <include url="classpath:/default/data/calibration.xml" />

        <fact.filter.MovingAverage key="DataCalibrated"
                                   outputKey="DataSmoothed"
                                   length="5" />

        <fact.statistics.TimerowFeatures dataKey="DataCalibrated"
                                         movingAverageKey="DataSmoothed"
                                         searchWindowLeft="35"
                                         searchWindowRight="200"
                                         outputKey="voltages" />

<!--         <fact.extraction.ChargeRandSampleGivenWindow key="DataCalibrated"
                                                     outputKey="PedIntegral"
                                                     skipFirst="${skipFirst}"
                                                     skipLast="${skipLast}"
                                                     windowSize="${searchWindowSize}" /> -->

        <fact.statistics.Derivation key="DataSmoothed"
                                    outputKey="slopeKey" />

        <fact.features.singlePulse.ArrivalTimeFromSlope key="DataSmoothed"
                                                        outputKey="arrivalTimes"
                                                        derivationKey="slopeKey"
                                                        visualizeKey="arrivalTimesVisual"
                                                        baselineKey="baselines"
                                                        skipFirstSlices="${skipFirst}"
                                                        skipLastSlices="${skipLast}"/>

        <fact.features.singlePulse.FindMaxSlope key="DataCalibrated"
                                                derivationKey="slopeKey"
                                                outputKey="maxSlopes"
                                                outputKeyVisualization="maxSlopePos"
                                                arrivalTimeKey="arrivalTimes"
                                                maxSearchSlice="${searchWindowSize}"
                                                numFitSlices="8"/>

        <fact.extraction.MinAmplitudeGlobal key="DataCalibrated"
                                            skipFirstSlices="${skipFirst}"
                                            skipLastSlices="${skipLast}"
                                            outputKey="globalMin"/>


        <!--<fact.plotter.HistogramArrayPlotter key="PedIntegral_sum" binWidth="1" logAxis="true" color="#666699" />-->
        <!--<fact.plotter.HistogramArrayPlotter key="PedIntegral_kurtosis" binWidth="1" logAxis="true" color="#666699" />-->
        <!--<fact.plotter.HistogramArrayPlotter key="PedIntegral_skewness" binWidth="1" logAxis="true" color="#666699" />-->
        <!--<fact.plotter.HistogramArrayPlotter key="PedIntegral_min" binWidth="1" logAxis="true" color="#666699" />-->
        <!--<fact.plotter.HistogramArrayPlotter key="PedIntegral_max" binWidth="1" logAxis="true" color="#666699" />-->
        <!--<fact.plotter.HistogramArrayPlotter key="PedIntegral_mean" binWidth="1" logAxis="true" color="#666699" />-->
        <!--<fact.plotter.HistogramArrayPlotter key="PedIntegral_median" binWidth="1" logAxis="true" color="#666699" />-->

        <!--<fact.plotter.HistogramArrayPlotter key="voltages_mean" binWidth="1" logAxis="true" color="#666699" />-->
        <!--<fact.plotter.HistogramArrayPlotter key="voltages_median" binWidth="1" logAxis="true" color="#666699" />-->
        <!--<fact.plotter.HistogramArrayPlotter key="voltages_kurtosis" binWidth="1" logAxis="true" color="#666699" />-->
        <!--<fact.plotter.HistogramArrayPlotter key="voltages_skewness" binWidth="1" logAxis="true" color="#666699" />-->

        <!--<fact.plotter.HistogramArrayPlotter key="baselines" binWidth="1" logAxis="true" color="#666699" />-->
        <!--<fact.plotter.HistogramArrayPlotter key="maxSlopes" binWidth="1" logAxis="true" color="#666699" />-->
        <!--<fact.plotter.HistogramArrayPlotter key="globalMin" binWidth="1" logAxis="true" color="#666699" />-->
        <!--<fact.plotter.HistogramArrayPlotter key="voltages_min" binWidth="1" logAxis="true" color="#666699" />-->

        <!--<fact.ShowViewer key="DataCalibrated"/>-->
        <PrintData/>
<!--         <fact.io.JSONWriter url="file:${outfile}" keys="RUNTYPE, PedIntegral,PedIntegral_min,PedIntegral_max,PedIntegral_sum,PedIntegral_median,PedIntegral_mean,PedIntegral_var,PedIntegral_skewness,PedIntegral_kurtosis,globalMin,arrivalTimes,baselines,maxSlopes,voltages_mean,voltages_median,voltages_mode,voltages_std,voltages_kurtosis,voltages_skewness,voltages_min,voltages_max"/> -->




    </process>


</container>
