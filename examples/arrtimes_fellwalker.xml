<container>

    <properties url="classpath:/default/settings.properties" />


    <!-- Pathes to the input files -->

    <property name="infolder" value="file:/home/lena/Dokumente/Masterarbeit/FACT_Data/MC/Proton/" />
    <property name="outfolder" value="file:/home/lena/Dokumente/Masterarbeit/FellWalker/Separation/" />
    <property name="filename" value="proton1" />
    <property name="label" value="0"/>




    <property name="integralGainFile" value="classpath:/default/defaultIntegralGains.csv" />
    <property name="drsfile" value="classpath:/testMcDrsFile.drs.fits.gz" />


    <service id="auxService" class="fact.auxservice.AuxFileService" auxFolder="file:src/main/resources/aux/" />

    <service id="calibService" class="fact.calibrationservice.ConstantCalibService" />


    <stream id="fact" class="fact.io.RecursiveDirectoryStream"
            pattern="*_Events.fits.gz"  url="${infolder}" limit="1000">
        <stream class="fact.io.FitsStream" id="_" />
    </stream>

    <process id="2" input="fact" >

        <include url="classpath:/default/mc/calibration_mc.xml" />

        <fact.extraction.BasicExtraction
                dataKey="DataCalibrated"
                outputKeyMaxAmplPos="maxPos"
                outputKeyPhotonCharge="photoncharge"
                url="${integralGainFile}"
                startSearchWindow="${basicExtraction_startSearchWindow}"
                rangeSearchWindow="${basicExtraction_rangeSearchWindow}"
                rangeHalfHeightWindow="${basicExtraction_rangeHalfHeigthWindow}"/>

        <fact.extraction.RisingEdgeForPositions
                dataKey="DataCalibrated"
                outputKey="ArrtimePos"
                amplitudePositionsKey="maxPos"
                maxSlopesKey="maxSlope"/>

        <fact.cleaning.MotionCleaning
                threshold = "30"
                outputKey = "pixelSet"
                numPixelKey="numShowerPixel"/>

        <Skip condition="%{data.numShowerPixel} &lt; 15 "/>

        <fact.features.DistributionFromShower
                weightsKey="photoncharge"
                pixelSetKey="pixelSet"
                sizeKey="Size"
                outputKey="showerDistribution"
        />

        <fact.hexmap.ClusterFellwalker
                pixelSetKey="pixelSet"
                minShowerpixel="2"
        />


        <fact.features.ClusterArrivalTimes
                pixelSetKey="pixelSet"
                minShowerpixel="2"
        />

        <Skip condition="%{data.numCluster} == 0" />

        <fact.features.SetLabel
            label="${label}"
            />


        <fact.ShowViewer key="DataCalibrated"/>

        <!--<fact.io.JSONWriter keys="EventNum,MCorsikaEvtHeader.fTotalEnergy,numShowerPixel,numCluster,boundRatio,idealBoundDiff,boundAngleSum,distanceCenterSum,neighborCluster,chargeMax,maxClusterNumPixel,numClusterPixel,stdNumPixel,convexity" url="${outfolder}${filename}.json"/>-->

    </process>

</container>
