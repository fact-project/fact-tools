<container>
  <properties url="classpath:/default/settings.properties" />
  <!-- Pathes to the input files -->
  <property name="infile" value="file:src/main/resources/testDataFile.fits.gz" />
  <property name="drsfile" value="file:src/main/resources/testDrsFile.drs.fits.gz" />
  <property name="integralGainFile" value="classpath:/default/gain_sorted_20131127.csv" />
  <property name="pixelDelayFile" value="classpath:/default/delays_lightpulser_20150217.csv" />
  <property name="auxFolder" value="file:src/main/resources/aux/" />

  <service id="auxService" class="fact.auxservice.AuxFileService" auxFolder="${auxFolder}" />
  <service id="calibService" class="fact.calibrationservice.ConstantCalibService" />

  <stream id="fact" class="fact.io.zfits.ZFitsStream"  url="${infile}"/>

  <!-- Description of the process and the corresponding stream -->
  <process id="2" input="fact">

    <fact.utils.PreviousEventInfo startCellKey="StartCellData" outputKey="prevEvents" limitEvents="10" />

    <fact.datacorrection.DrsCalibration
        url="${drsfile}"
        key="Data"
        outputKey="DataCalibrated"
   />
   <fact.datacorrection.PatchJumpRemoval
        dataKey="DataCalibrated"
        outputKey="DataJumpsRemoved"
        prevEventsKey="prevEvents"
        startCellKey="StartCellData"
        jumpLimit="${patchJumpRemoval_jumpLimit}"
    />
    <fact.datacorrection.RemoveSpikes
        dataKey="DataJumpsRemoved"
        outputKey="DataSpikesRemoved"
        startCellKey="StartCellData"
        leftBorder="${removeSpikes_leftBorder}"
        spikeLimit="${removeSpikes_spikeLimit}"
        topSlopeLimit="${removeSpikes_topSlopeLimit}"
        maxSpikeLength="${removeSpikes_maxSpikeLength}"
    />
    <fact.filter.DrsTimeCalibration
        outputKey="timeCalibConst"
    />
    <fact.filter.ArrayTimeCorrection
        dataKey="DataSpikesRemoved"
        timeCalibConstKey="timeCalibConst"
        outputKey="DataTimeCorrected"
    />
    <fact.datacorrection.InterpolateTimeSeries 
        calibService="calibService"
        dataKey="DataTimeCorrected"
        dataOutputKey="DataInterpolated"
    />


    <fact.ShowViewer key="DataInterpolated" />
  </process>
</container>
