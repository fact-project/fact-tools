<container>

    <!-- Pfade zu den fits files. -->
    <property name="infile" value="src/test/resources/testDataFile.fits.gz" />
	<property name="drsfile" value="src/test/resources/testDrsFile.drs.fits.gz" />
	<property name="drivefile" value="src/test/resources/testDriveFile.fits" />
	<property name="drstimefile" value="src/test/resources/testDrsTimeFile.drs.time.fits" />
	<!-- <property name="infile" value="/home/fabian/mount/data/LinuxDaten/uni/FACT/Testdata/20141001_275.fits.fz" /> -->
	<!-- <property name="infile" value="/home/fabian/mount/data/LinuxDaten/uni/FACT/Testdata/20141001_277.fits.fz" />
	<property name="drsfile" value="/home/fabian/mount/data/LinuxDaten/uni/FACT/Testdata/20141001_273.drs.fits.gz" />
	<property name="drstimefile" value="/home/fabian/mount/data/LinuxDaten/uni/FACT/Testdata/20141001_272_drs_time_calibration.fits" />
	<property name="drivefile" value="/home/fabian/mount/data/LinuxDaten/uni/FACT/Testdata/20141001.DRIVE_CONTROL_TRACKING_POSITION.fits" /> -->
<!-- 	<property name="infile" value="/home/fabian/mount/Phido/fhgfs_app/fact/raw/2014/02/06/20140206_047.fits.fz" />
	<property name="drsfile" value="/home/fabian/mount/Phido/fhgfs_app/fact/raw/2014/02/06/20140206_046.drs.fits.gz" /> -->
	<!-- <property name="drivefile" value="src/test/resources/testDriveFile.fits" /> -->
    <property name="sourcename" value="crab" />
    <property name="core_threshold" value="6.0" />
    <property name="neighbor_threshold" value="3.0"/>
    <property name="time_threshold" value="30.0" />
    <property name="min_number_of_pixel" value="2" />
    <property name="integralGainFile" value="src/main/resources/gain_sorted_20131127.csv" />
    <!-- <property name="integralGainFile" value="/home/fact_opr/facttools/gain_sorted_20131127.csv" /> -->


    <!-- Name des Streams und pfad zu dem Daten-File -->
    <!-- <stream id="fact" class="fact.io.zfits.ZFitsStream"  url="file:${infile}"/> -->
    <stream id="fact" class="fact.io.FitsStream"  url="file:${infile}"/>

    <!-- Beschreibung des zu bearbeitenden Prozesses und zu welchem Stream dieser gehÃ¶rt -->
    <process id="2" input="fact">
        <fact.utils.PreviousEventInfo 
        	startCellKey="StartCellData"
        	outputKey="prevEvents"
        	limitEvents="10"
        />
        <stream.flow.Skip condition="%{data.EventNum} &lt; 0" />
        <!-- <stream.flow.Skip condition="%{data.TriggerType} != 1024" /> -->
        <!-- <fact.io.zfits.ZFitsDrsCalib url="file:${infile}" optional="false" outputKey="DataZCal" /> 
        <fact.filter.DrsCalibration url="file:${drsfile}" key="DataZCal"  outputKey="DataCalibrated"/> -->
        <fact.filter.DrsCalibration 
	        url="file:${drsfile}" 
	        key="Data"  
	        outputKey="DataCalibrated"
	    />
        <fact.filter.DrsTimeCalibration 
        	url="file:${drstimefile}" 
        	outputKey="timeCalibConst"
        />
        <fact.filter.ArrayTimeCorrection 
        	dataKey="DataCalibrated" 
        	timeCalibConstKey="timeCalibConst" 
        	outputKey="DataCalibrated" 
        />
        <fact.datacorrection.PatchJumpRemoval 
        	dataKey="DataCalibrated" 
        	outputKey="DataCalibrated" 
        	outputJumpsKey="j" 
        	prevEventsKey="prevEvents" 
        	startCellKey="StartCellData" 
        	jumpLimit="2.0" 
        />
        <fact.datacorrection.RemoveSpikes 
        	dataKey="DataCalibrated" 
        	outputKey="DataCalibrated" 
        	startCellKey="StartCellData" 
        	leftBorder="6" 
        	spikeLimit="20" 
        	topSlopeLimit="16" 
        	maxSpikeLength="4" 
        	outputSpikesKey="Sp" 
        />
        <fact.datacorrection.InterpolateBadPixel 
        	key="DataCalibrated"  
        	outputKey="DataCalibrated"
            badChidIds="863,868,297,927,80,873,1093,1094,527,528,721,722" 
        />
        <fact.extraction.BasicExtraction
        	dataKey="DataCalibrated" 
        	outputKeyMaxAmplPos="maxAmplitudePosition"
        	outputKeyPhotonCharge="photoncharge" 
        	url="file:${integralGainFile}"
        	startSearchWindow="35"
        	rangeSearchWindow="60"
        	rangeHalfHeightWindow="25"
        />
        <fact.extraction.RisingEdgeForPositions 
        	dataKey="DataCalibrated" 
        	amplitudePositionsKey="maxAmplitudePosition" 
        	outputKey="arrivalTime" 
        	maxSlopesKey="maxSlopes"
        />
        <fact.extraction.RisingEdgePolynomFit 
        	dataKey="DataCalibrated" 
        	risingEdgeKey="arrivalTime" 
        	outputKey="arrivalTimeFit" 
        	range="5" 
        	maxSlopesKey="maxSlopesFit"
        />
        <fact.cleaning.CoreNeighborClean 
        	photonChargeKey="photoncharge" 
        	outputKey="shower" 
        	arrivalTimeKey="arrivalTime" 
        	corePixelThreshold="${core_threshold}" 
        	neighborPixelThreshold="${neighbor_threshold}" 
        	timeThreshold="${time_threshold}"  
        	minNumberOfPixel="${min_number_of_pixel}"
        />
        <fact.cleaning.CoreNeighborCleanTimeNeighbor
        	photonChargeKey="photoncharge" 
        	outputKey="showerTimeNeighbor" 
        	arrivalTimeKey="arrivalTime" 
        	corePixelThreshold="${core_threshold}" 
        	neighborPixelThreshold="${neighbor_threshold}" 
        	timeThreshold="15"  
        	minNumberOfPixel="${min_number_of_pixel}"
        />
		<stream.data.PrintData />
        <fact.ShowViewer key="DataCalibrated"/>


    </process>


</container>
