<container>

    <!-- Pfade zu den fits files. -->
    <property name="infile" value="/home/fabian/mount/Phido/fhgfs_app/fact/simulated/ceres_2_0/proton_klaus_4_psf_3_0/17220/00000003.220_D_MonteCarlo017_Events.fits" />
    <property name="drsfile" value="/home/fabian/mount/Phido/fhgfs_app/fact/simulated/drsfiles/12bitADC/offsetMinus1850/test300samples.drs.fits" />
    <property name="outfile" value="/home/fabian/mount/data/LinuxDaten/uni/FACT/Testoutput/proton_klaus_4_psf_3_test.csv" />
    <property name="core_threshold" value="5.0" />
    <property name="neighbor_threshold" value="2.0"/>
    <property name="time_threshold" value="30.0" />
    <property name="min_number_of_pixel" value="2" />
    <property name="integral_gain" value="242.0" />

    <!-- Name des Streams und pfad zu dem Daten-File -->
    <stream id="fact" class="fact.io.FitsStream"  url="file:${infile}"/>

    <!-- Beschreibung des zu bearbeitenden Prozesses und zu welchem Stream fieser gehÃ¶rt -->
    <process id="2" input="fact">
        <fact.utils.Remapping key="Data" />
        <fact.filter.DrsCalibration url="file:${drsfile}" key="Data"  outputKey="DataCalibrated" color="#000000"/>  
        <fact.utils.CutSlices start="22" end="220" outputKey="DataCalibrated"/>


        <fact.features.MaxAmplitudePosition key="DataCalibrated" outputKey="maxAmplitudePosition"/>
        <fact.features.RisingEdge key="DataCalibrated" outputKey="arrivalTime"/>
        <fact.features.PhotonCharge key="DataCalibrated" positions="maxAmplitudePosition" outputKey="photoncharge" integralGain="${integral_gain}" color="#FF0F0F"/>
        <fact.features.SourcePosition outputKey="sourcePosition" X="0.0" Y="0.0"/>
        <fact.features.AntiSourcePosition sourcePositionKey="sourcePosition" numberOfAntiSourcePositions="5" antiSourcePositionId="1" outputKey="antiSourcePosition_1"/>
        <fact.features.AntiSourcePosition sourcePositionKey="sourcePosition" numberOfAntiSourcePositions="5" antiSourcePositionId="2" outputKey="antiSourcePosition_2"/>
        <fact.features.AntiSourcePosition sourcePositionKey="sourcePosition" numberOfAntiSourcePositions="5" antiSourcePositionId="3" outputKey="antiSourcePosition_3"/>
        <fact.features.AntiSourcePosition sourcePositionKey="sourcePosition" numberOfAntiSourcePositions="5" antiSourcePositionId="4" outputKey="antiSourcePosition_4"/>
        <fact.features.AntiSourcePosition sourcePositionKey="sourcePosition" numberOfAntiSourcePositions="5" antiSourcePositionId="5" outputKey="antiSourcePosition_5"/>

        <fact.cleaning.CoreNeighborClean key="photoncharge" outputKey="shower" keyPositions="arrivalTime" corePixelThreshold="${core_threshold}" neighborPixelThreshold="${neighbor_threshold}" timeThreshold="${time_threshold}"  minNumberOfPixel="${min_number_of_pixel}"/>


        <Skip condition="%{data.shower} == null" />

            <fact.features.NumberOfPixelInShower showerKey="shower" outputKey="numPixelInShower" />
            <fact.features.Size showerKey="shower" photonchargeKey="photoncharge" outputKey="Size" />       
            <fact.features.video.CenterOfGravity datacalibrated="DataCalibrated" showerpixel="shower" outputKey="videoCog"/>
            <fact.features.DistributionFromShower weights="photoncharge" key="shower" outputKey="showerDistribution" />

            <fact.features.HillasAlpha distribution="showerDistribution" sourcePosition="sourcePosition" outputKey="Alpha" />
            <fact.features.HillasDistance distribution="showerDistribution" sourcePosition="sourcePosition" outputKey="Distance" />

            <fact.features.HillasAlpha distribution="showerDistribution" sourcePosition="antiSourcePosition_1" outputKey="Alpha_Off_1" />
            <fact.features.HillasDistance distribution="showerDistribution" sourcePosition="antiSourcePosition_1" outputKey="Distance_Off_1" />
            <fact.features.HillasAlpha distribution="showerDistribution" sourcePosition="antiSourcePosition_2" outputKey="Alpha_Off_2" />
            <fact.features.HillasDistance distribution="showerDistribution" sourcePosition="antiSourcePosition_2" outputKey="Distance_Off_2" />
            <fact.features.HillasAlpha distribution="showerDistribution" sourcePosition="antiSourcePosition_3" outputKey="Alpha_Off_3" />
            <fact.features.HillasDistance distribution="showerDistribution" sourcePosition="antiSourcePosition_3" outputKey="Distance_Off_3" />
            <fact.features.HillasAlpha distribution="showerDistribution" sourcePosition="antiSourcePosition_4" outputKey="Alpha_Off_4" />
            <fact.features.HillasDistance distribution="showerDistribution" sourcePosition="antiSourcePosition_4" outputKey="Distance_Off_4" />
            <fact.features.HillasAlpha distribution="showerDistribution" sourcePosition="antiSourcePosition_5" outputKey="Alpha_Off_5" />
            <fact.features.HillasDistance distribution="showerDistribution" sourcePosition="antiSourcePosition_5" outputKey="Distance_Off_5" />

            <fact.features.HillasConcentration weights="photoncharge" shower="shower" outputKey="Concentration" />
            <fact.features.HillasLength distribution="showerDistribution" outputKey="HillasLength" />
            <fact.features.HillasWidth distribution="showerDistribution" outputKey="HillasWidth" />
            <fact.features.Leakage distribution="showerDistribution" shower="shower" weights="photoncharge" outputKey="Leakage" />
            <fact.features.ConcentrationCore cogx="COGx" cogy="COGy" showerPixel="shower" photoncharge="photoncharge" size="Size" width="Width" length="Length" delta="Delta" outputKey="ConcCore" />
            <fact.features.CosDeltaAlpha sourcePosition="sourcePosition" cogX="COGx" cogY="COGy" hillasDelta="Delta" outputKey="CosDeltaAlpha" />
            <!-- Error  <fact.features.ConcentrationAtCenterOfGravity photonCharge="photoncharge" cogX="COGx" cogY="COGy" hillasSize="Size" outputKey="concCOG" /> -->
            <fact.features.NumberOfIslands key="shower" outputKey="numIslands" />
            <fact.features.SlopeSpreadWeighted showerPixel="shower" arrivaltime="arrivalTime" photonCharge="photoncharge" hillasDelta="Delta" outputKey="SlopeSpreadWeighted" />
            <fact.features.SourceLineTest photonCharge="photoncharge" hillasLength="HillasLength" hillasWidth="HillasWidth" arrivalTime="arrivalTime" showerPixel="shower" sourcePosition="sourcePosition" outputKey="SourceLineTest" />
            <fact.features.NaiveShowerLineFit showerPixel="shower" hillasDelta="Delta" outputKey="SLF" />
            <fact.statistics.ArrayMean key="photoncharge" outputKey="photonchargeMean" />
            <fact.statistics.ArrayMean key="arrivalTime" outputKey="arrivalTimeMean" />
            
            <fact.io.RootASCIIWriter url="file:${outfile}" keys="EventNum,MCorsikaEvtHeader.fTotalEnergy,MCorsikaEvtHeader.fZd,MCorsikaEvtHeader.fAz,MMcEvt.fFirstTarget,MMcEvt.fPhotElfromShower,CorsikaEvtHeader.fFirstInteractionHeight,MCorsikaEvtHeader.fMomentumX,MCorsikaEvtHeader.fMomentumY,MCorsikaEvtHeader.fMomentumZ,SLF_SlopeRelErr,SLF_Intercept,SLF_Slope,SLF_InterceptStdErr,SLF_SlopeStdErr,SLF_RSquare,SLF_RegressionSumSquares,videoCog_MinVel,videoCog_MinVelId,videoCog_MaxVel,videoCog_MaxVelId,videoCog_BestVel,videoCog_BestVelError,videoCog_BestVelId,varianceLong,varianceTrans,M3Long,M3Trans,M4Long,M4Trans,COGx,COGy,Width,Length,Size,Delta,Alpha,Distance,Alpha_Off_1,Distance_Off_1,Alpha_Off_2,Distance_Off_2,Alpha_Off_3,Distance_Off_3,Alpha_Off_4,Distance_Off_4,Alpha_Off_5,Distance_Off_5,Concentration_onePixel,Concentration_twoPixel,HillasLength,HillasWidth,Leakage,Leakage2,ConcCore,CosDeltaAlpha,numIslands,numPixelInShower,SlopeSpreadWeighted_slopeLong,SlopeSpreadWeighted_slopeSpread,SlopeSpreadWeighted_slopeSpreadWeighted,SlopeSpreadWeighted_slopeTrans,SlopeSpreadWeighted_timeSpread,SlopeSpreadWeighted_timeSpreadWeighted,SourceLineTest_meanShowerVelocity,SourceLineTest_sourceLineTestValue,photonchargeMean,photonchargeMean_deviation,arrivalTimeMean,arrivalTimeMean_deviation,sourcePosition,antiSourcePosition_1,antiSourcePosition_2,antiSourcePosition_3,antiSourcePosition_4,antiSourcePosition_5"/>


    </process>


</container>
