<container>
  <properties url="classpath:/default/settings.properties" />
  <!-- Pathes to the input files -->
  <property name="infile" value="file:src/test/resources/testDataFile2.fits.fz" />
  <property name="outfile" value="file:test_out.fits" />
  <property name="drsfile" value="file:src/test/resources/testDrsFile2.drs.fits.gz" />
  <property name="integralGainFile" value="classpath:/default/gain_sorted_20131127.csv" />
  <property name="pixelDelayFile" value="classpath:/default/delays_lightpulser_20150217.csv" />
  <property name="auxFolder" value="file:src/test/resources/aux/" />
  <property name="fitParameterFile" value="file:src/main/resources/default/drsTempCalib_FitParameter.fits" />

  <service id="auxService" class="fact.auxservice.AuxFileService" auxFolder="${auxFolder}" />
  <service id="calibService" class="fact.calibrationservice.ConstantCalibService" />

  <stream id="fact" class="fact.io.hdureader.FITSStream"  url="${infile}"/>

  <!-- Description of the process and the corresponding stream -->
  <process id="2" input="fact">

  <fact.utils.PreviousEventInfo startCellKey="StartCellData" outputKey="prevEvents" limitEvents="10" />

  <fact.datacorrection.DrsCalibration
    url="${drsfile}"
    key="Data"
    outputKey="DRSCalibratedData"
  />

  <fact.datacorrection.PatchJumpRemoval
      dataKey="DRSCalibratedData"
      outputKey="DRSCalibratedData"
      prevEventsKey="prevEvents"
      startCellKey="StartCellData"
      jumpLimit="${patchJumpRemoval_jumpLimit}"
  />

  <fact.datacorrection.RemoveSpikes
      dataKey="DRSCalibratedData"
      outputKey="DRSCalibratedData"
      startCellKey="StartCellData"
      leftBorder="${removeSpikes_leftBorder}"
      spikeLimit="${removeSpikes_spikeLimit}"
      topSlopeLimit="${removeSpikes_topSlopeLimit}"
      maxSpikeLength="${removeSpikes_maxSpikeLength}"
  />

  <fact.features.TimeSeriesNoise
      dataKey="DRSCalibratedData"
      outputKey="DRSCalibratedDataNoise"
  />

  <fact.datacorrection.DrsTemperatureCalibration
    auxService="auxService"
    drsFitFilePath="${fitParameterFile}"
    key="Data"
    outputKey="DRSCalibratedData_Temp"
  />

  <fact.datacorrection.PatchJumpRemoval
      dataKey="DRSCalibratedData_Temp"
      outputKey="DRSCalibratedData_Temp"
      prevEventsKey="prevEvents"
      startCellKey="StartCellData"
      jumpLimit="${patchJumpRemoval_jumpLimit}"
  />
  <fact.datacorrection.RemoveSpikes
      dataKey="DRSCalibratedData_Temp"
      outputKey="DRSCalibratedData_Temp"
      startCellKey="StartCellData"
      leftBorder="${removeSpikes_leftBorder}"
      spikeLimit="${removeSpikes_spikeLimit}"
      topSlopeLimit="${removeSpikes_topSlopeLimit}"
      maxSpikeLength="${removeSpikes_maxSpikeLength}"
  />

  <fact.features.TimeSeriesNoise
      dataKey="DRSCalibratedData_Temp"
      outputKey="DRSCalibratedDataNoise_Temp"
  />

  <!--
  <fact.io.FITSWriter
    url="${outfile}"
    keys="DRSCalibratedDataNoise, DRSCalibratedDataNoise_Temp"
    extname="StdPerPixel"
  />
  -->

    <!-- <fact.ShowViewer key="DataCalibratedDRS_Temp" />         keys="DRSCalibratedDataNoise, DRSCalibratedData_TempNoise, DRSCalibratedData_TempIntervalNoise" -->
  </process>
</container>
