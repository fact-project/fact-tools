<container>

    <properties url="classpath:/default/settings.properties" />

    <!-- Pathes to the input files -->
    <property name="infile" value="file:src/main/resources/testDataFile.fits.gz" />
    <property name="drsfile" value="file:src/main/resources/testDrsFile.drs.fits.gz" />

    <property name="integral_gain_file" value="classpath:/default/gain_sorted_20131127.csv" />
    <property name="pixel_delay_file" value="classpath:/default/delays_lightpulser_20150217.csv" />

    <!--In case you want to analyze .zfits files.-->
    <!--<stream id="fact" class="fact.io.hdureader.FITSStream"  url="${infile}"/>-->

    <!-- Name of the stream and url to the input file -->
    <stream id="fact" class="fact.io.hdureader.FITSStream" url="${infile}"/>

    <!-- Description of the process and the corresponding stream -->
    <process id="2" input="fact">
        <fact.utils.PreviousEventInfo
                startCellKey="StartCellData"
                outputKey="prev_events"
                limitEvents="10"
        />
        <!-- <stream.flow.Skip condition="%{data.EventNum} &lt; 0" /> -->
        <!-- <stream.flow.Skip condition="%{data.TriggerType} != 1024" /> -->
        <fact.datacorrection.DrsCalibration
                url="${drsfile}"
                key="Data"
                outputKey="data_calibrated"
        />
        <fact.datacorrection.PatchJumpRemoval
                dataKey="data_calibrated"
                outputKey="data_calibrated"
                prevEventsKey="prev_events"
                startCellKey="StartCellData"
                jumpLimit="${patch_jump_removal_jump_limit}"
        />
        <fact.datacorrection.RemoveSpikes
                dataKey="data_calibrated"
                outputKey="data_calibrated"
                startCellKey="StartCellData"
                leftBorder="${remove_spikes_left_border}"
                spikeLimit="${remove_spikes_spike_limit}"
                topSlopeLimit="${remove_spikes_top_slope_limit}"
                maxSpikeLength="${remove_spikes_max_spike_length}"
        />
        <fact.filter.DrsTimeCalibration
                outputKey="time_calib_const"
        />
        <fact.filter.ArrayTimeCorrection
                dataKey="data_calibrated"
                timeCalibConstKey="time_calib_const"
                outputKey="data_calibrated"
        />

        <fact.filter.GaussConvolution
                key="data_calibrated"
                outputKey="data_smoothed"
                variance="3"/>

        <fact.statistics.Derivation
                key="data_smoothed"
                outputKey="1_derivation" />

        <fact.filter.MovingAverage
                key="1_derivation"
                outputKey="1_derivation_smoothed"
                length="2"/>

        <fact.extraction.TimeOverThresholdTL
                dataKey="1_derivation_smoothed"
                threshold="0.5"
                outputKey="time_over_thresh" />



        <!--Uncomment to use the viewer-->
        <!--<fact.ShowViewer key="DataCalibrated"/>-->


    </process>


</container>
