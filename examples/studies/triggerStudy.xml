<container>

	<property name="fhgfs" value="/home/fabian/mount/Phido/fhgfs_app" />
    <property name="config" value="src/main/resources" />
<!--     <property name="fhgfs" value="/fhgfs/groups/app" />
    <property name="config" value="/home/fact_opr/facttools" />
 -->
    <property name="infile" value="${fhgfs}/fact/raw/2013/09/29/20130929_179.fits.gz" />
    <property name="drsfile" value="${fhgfs}/fact/raw/2013/09/29/20130929_167.drs.fits.gz" />
    <property name="drstimefile" value="${fhgfs}/fact/raw/2013/09/29/20130929_166.drs.time.fits" />
    <property name="drivefile" value="${fhgfs}/fact/aux/2013/09/29/20130929.DRIVE_CONTROL_TRACKING_POSITION.fits" />
    <property name="integralGainFile" value="${config}/gain_sorted_20131127.csv" />
    <property name="pixelDelayFile" value="${config}/delays_20141114.csv" />

    <!-- Pathes to the input files -->
<!--     <property name="infile" value="src/test/resources/testDataFile.fits.gz" />
	<property name="drsfile" value="src/test/resources/testDrsFile.drs.fits.gz" />
	<property name="drivefile" value="src/test/resources/testDriveFile.fits" />
	<property name="drstimefile" value="src/test/resources/testDrsTimeFile.drs.time.fits" />

    <property name="integralGainFile" value="src/main/resources/gain_sorted_20131127.csv" />
    <property name="pixelDelayFile" value="src/main/resources/delays_20141114.csv" /> -->
    
    <property name="outfile" value="/home/fabian/triggerTest.txt" />
	
    <property name="sourcename" value="crab" />
    <property name="core_threshold" value="7.0" />
    <property name="neighbor_threshold" value="4.5"/>
    <property name="time_limit" value="10.0" />
    <property name="min_number_of_pixel" value="2" />
    <property name="start_search_window" value="35" />
    <property name="range_search_window" value="60" />


    <!-- Name of the stream and url to the input file -->
    <stream id="fact" class="fact.io.FitsStream"  url="file:${infile}" limit="100"/>

    <!-- Description of the process and the corresponding stream -->
    <process id="2" input="fact">
        <fact.utils.PreviousEventInfo 
        	startCellKey="StartCellData"
        	outputKey="prevEvents"
        	limitEvents="10"
        />
        <!-- <stream.flow.Skip condition="%{data.EventNum} &lt; 0" /> -->
        <stream.flow.Skip condition="%{data.TriggerType} != 4" />
        
        <include file="examples/stdAnalysis/data/calibration.xml" />
        
        <!-- Extraction -->
        <!-- BasicExtraction, RisingEdgeForPositions, RisingEdgePolynomFit, TimeOverThreshold,
        PhotonChargeTimeOverThreshold, HandleSaturation, CorrectPixelDelays-->
        <include file="examples/stdAnalysis/data/extraction.xml" />     
        <!-- Output: photoncharge, arrivalTime -->   

        <!-- Cleaning -->
        <!-- SourcePosition(Cetatauri), CoreNeighborCleanTimeNeighbor-->
        <include file="examples/stdAnalysis/data/cleaning.xml" />     
        <!-- Output: shower --> 
        
        <Skip condition="%{data.shower} == null" />
		<fact.features.NumberOfPixelInShower
		    showerKey="shower"
		    outputKey="numPixelInShower"
		/>
		<fact.features.Size 
		    showerKey="shower" 
		    photonChargeKey="photoncharge" 
		    outputKey="Size" 
		/> 
        
        <fact.triggerAnalysis.PatchDataArray dataKey="DataCalibrated" outputKey="PatchData" />
        
        <fact.filter.ShapeSignal key="PatchData" shift="10" factor="0.96" outputKey="PatchData_shaped"/>
        <!-- <fact.filter.ShapeSignal key="PatchData_viewer" shift="10" factor="0.96" outputKey="PatchData_viewer_shaped"/> -->
        
        <fact.triggerAnalysis.TriggerSignal triggerDataKey="PatchData_shaped" outputKey="t21"
        	threshold="129" searchWindowStart="30" searchWindowRange="100" numberPixelPerPatch="9" />
        <fact.triggerAnalysis.TriggerSignal triggerDataKey="PatchData_shaped" outputKey="t23"
        	threshold="149" searchWindowStart="30" searchWindowRange="100" numberPixelPerPatch="9" />
        <fact.triggerAnalysis.TriggerSignal triggerDataKey="PatchData_shaped" outputKey="t25"
        	threshold="169" searchWindowStart="30" searchWindowRange="100" numberPixelPerPatch="9" />
        <fact.triggerAnalysis.TriggerSignal triggerDataKey="PatchData_shaped" outputKey="t27"
        	threshold="189" searchWindowStart="30" searchWindowRange="100" numberPixelPerPatch="9" />
        <fact.triggerAnalysis.TriggerSignal triggerDataKey="PatchData_shaped" outputKey="t29"
        	threshold="209" searchWindowStart="30" searchWindowRange="100" numberPixelPerPatch="9" />
        <fact.triggerAnalysis.TriggerSignal triggerDataKey="PatchData_shaped" outputKey="t31"
        	threshold="229" searchWindowStart="30" searchWindowRange="100" numberPixelPerPatch="9" />
        <fact.triggerAnalysis.TriggerSignal triggerDataKey="PatchData_shaped" outputKey="t33"
        	threshold="249" searchWindowStart="30" searchWindowRange="100" numberPixelPerPatch="9" />
        	
        <fact.statistics.ArrayStatistics key="t21" outputKey="t21_stat" />
        <fact.statistics.ArrayStatistics key="t23" outputKey="t23_stat" />
        <fact.statistics.ArrayStatistics key="t25" outputKey="t25_stat" />
        <fact.statistics.ArrayStatistics key="t27" outputKey="t27_stat" />
        <fact.statistics.ArrayStatistics key="t29" outputKey="t29_stat" />
        <fact.statistics.ArrayStatistics key="t31" outputKey="t31_stat" />
        <fact.statistics.ArrayStatistics key="t33" outputKey="t33_stat" />
                
        
        <!-- <Skip condition="%{data.shower} == null" /> -->
        
            
        <!-- <fact.ShowViewer key="DataCalibrated"/> -->
        
        <fact.io.RootASCIIWriter url="file:${outfile}" keys="EventNum,Size,numPixelInShower,t21_stat_max,t23_stat_max,t25_stat_max,t27_stat_max,t31_stat_max,t33_stat_max" />


    </process>


</container>
