<container>

<!-- Closed Shutter Data: -->
<!--<property name="fhgfs" 		value="/net/home.e5.physik.tu-dortmund.de/vol/ph_e5v/e5b/homes/jbuss/e5/fhgfs" />-->
<property name="infile" value="${fhgfs}/groups/app/fact/raw/2013/10/02/20131002_045.fits.gz" />
<property name="drsfile" value="${fhgfs}/groups/app/fact/raw/2013/10/02/20131002_040.drs.fits.gz" />
<property name="outfile" value="file:/net/home.e5.physik.tu-dortmund.de/vol/ph_e5v/e5b/homes/jbuss/test.json" />

    <stream id="fact" class="fact.io.FitsStream" 
            url="file:${infile}"/>
            
        <process input="fact">
        <fact.utils.PreviousEventInfo startCellKey="StartCellData" outputKey="prevEvents" limitEvents="5"/>
        <stream.flow.Skip condition="%{data.EventNum} &lt; 0" />
         <stream.flow.Skip condition="%{data.TriggerType} != 1024" />
        <fact.filter.DrsCalibration url="file:${drsfile}" key="Data"  outputKey="DataCalibrated" color="#000000"/>
        <fact.datacorrection.PatchJumpRemoval dataKey="DataCalibrated" outputKey="DataCalibrated" color="#E6172F" outputJumpsKey="j" prevEventsKey="prevEvents" startCellKey="StartCellData" jumpLimit="2.0" />
        <fact.datacorrection.RemoveSpikes dataKey="DataCalibrated" outputKey="DataCalibrated" startCellKey="StartCellData" leftBorder="6" spikeLimit="20" topSlopeLimit="16" maxSpikeLength="4" outputSpikesKey="Sp" color="#000000" />

        <fact.filter.GaussConvolution key="DataCalibrated" outputKey="DataSmoothed" variance="5"/>
        <!--<fact.filter.FirFilter key="DataSmoothed" outputKey="DataFiltered" coefficients="-->
              <!---0.0001532531869752378,-->
              <!--0.00027483101557697744,-->
              <!--0.00020805094265219693,-->
              <!--0.00020209454836774045,-->
              <!--0.0002138443894806364,-->
              <!--0.00022490373096952464,-->
              <!--0.0002267916698013417,-->
              <!--0.00021551617271523216,-->
              <!--0.00018966628716712963,-->
              <!--0.00014976187493502877,-->
              <!--0.00009798874011535673,-->
              <!--0.0000379777176409305,-->
              <!---0.000025492304236947266,-->
              <!---0.00008689923096278177,-->
              <!---0.00014049302887877223,-->
              <!---0.0001808698805668453,-->
              <!---0.00020355076392327846,-->
              <!---0.00020550897619134062,-->
              <!---0.00018558660380287622,-->
              <!---0.00014475102002096062,-->
              <!---0.00008613473789343864,-->
              <!---0.000014876616646236282,-->
              <!--0.00006229625447347436,-->
              <!--0.00013762263297549253,-->
              <!--0.00020313385543716415,-->
              <!--0.00025129530155059066,-->
              <!--0.0002761074430862418,-->
              <!--0.0002734237861556655,-->
              <!--0.00024198428189485562,-->
              <!--0.00018326300041398026,-->
              <!--0.00010177361824173874,-->
              <!--0.000004744521729386702,-->
              <!---0.0000986612764118863,-->
              <!---0.00019796754416048594,-->
              <!---0.0002824911883995296,-->
              <!---0.0003425564804803397,-->
              <!---0.00037043311961797344,-->
              <!---0.0003612784993610939,-->
              <!---0.00031392527777645765,-->
              <!---0.00023115868498795148,-->
              <!---0.0001195808768791947,-->
              <!--0.00001079042116774322,-->
              <!--0.00014735081764449018,-->
              <!--0.00027616232514818777,-->
              <!--0.00038335249237054993,-->
              <!--0.00045654366766502164,-->
              <!--0.00048620463813092815,-->
              <!--0.00046685253645557237,-->
              <!--0.0003978553057458494,-->
              <!--0.00028377644920395877,-->
              <!--0.000134118444828564,-->
              <!---0.00003736705866755851,-->
              <!---0.00021396447130023755,-->
              <!---0.00037748833859792323,-->
              <!---0.0005101995198440321,-->
              <!---0.000596662739632874,-->
              <!---0.0006254774225729954,-->
              <!---0.0005907181361403068,-->
              <!---0.000492782263267057,-->
              <!---0.00033870204567137594,-->
              <!---0.00014173857730711593,-->
              <!--0.00007970942590158282,-->
              <!--0.00030375770471739705,-->
              <!--0.0005071779965350007,-->
              <!--0.0006677718518284225,-->
              <!--0.0007667261596272183,-->
              <!--0.0007907422624142932,-->
              <!--0.0007337176980505024,-->
              <!--0.0005977328913941834,-->
              <!--0.0003931955899840721,-->
              <!--0.00013818365054974588,-->
              <!---0.0001431160486873042,-->
              <!---0.0004226455151086228,-->
              <!---0.000671195174685452,-->
              <!---0.0008614494227763559,-->
              <!---0.0009709220911588188,-->
              <!---0.000984516201245384,-->
              <!---0.0008964319238104276,-->
              <!---0.0007112247528434015,-->
              <!---0.0004438002524462949,-->
              <!---0.00011829244928704584,-->
              <!--0.0002340367024979458,-->
              <!--0.0005776987863410642,-->
              <!--0.000876549527692335,-->
              <!--0.001097523416204855,-->
              <!--0.0012141948511847783,-->
              <!--0.0012098510520863832,-->
              <!--0.00107966687752577,-->
              <!--0.0008316992518709261,-->
              <!--0.0004866247231273881,-->
              <!--0.00007615365471434685,-->
              <!---0.000359853623445428,-->
              <!---0.0007771661428218825,-->
              <!---0.0011315675163482634,-->
              <!---0.0013835406161774187,-->
              <!---0.001502519838363339,-->
              <!---0.0014704848829605447,-->
              <!---0.0012844080918280958,-->
              <!---0.0009570948220111251,-->
              <!---0.0005166635298891603,-->
              <!---0.000004117683517692287,-->
              <!--0.000530263492242788,-->
              <!--0.0010318531096450252,-->
              <!--0.0014471472454258524,-->
              <!--0.0017294122784003922,-->
              <!--0.0018437917069870024,-->
              <!--0.0017714275483144606,-->
              <!--0.0015120845191814007,-->
              <!--0.0010849873962094846,-->
              <!--0.0005276301064771511,-->
              <!---0.00010741899810514048,-->
              <!---0.0007574277613441397,-->
              <!---0.0013555550703382986,-->
              <!---0.0018374950141107622,-->
              <!---0.0021483181858475784,-->
              <!---0.002248754931510682,-->
              <!---0.0021198217044335844,-->
              <!---0.001765388035502459,-->
              <!---0.0012129552507598228,-->
              <!---0.0005119460903520359,-->
              <!--0.00027104240117469723,-->
              <!--0.0010581596250525992,-->
              <!--0.001767547736107444,-->
              <!--0.0023226716718390684,-->
              <!--0.002659227732236504,-->
              <!--0.0027334335652668637,-->
              <!--0.0025266320478267643,-->
              <!--0.0020487184085070985,-->
              <!--0.0013380626525659346,-->
              <!--0.0004588012857748747,-->
              <!---0.0005047827344109434,-->
              <!---0.0014561513146110331,-->
              <!---0.0022960128396151197,-->
              <!---0.002932483148523807,-->
              <!---0.003290910916436153,-->
              <!---0.003322327927713805,-->
              <!---0.0030095937645275247,-->
              <!---0.002370510988411781,-->
              <!---0.001457466901256732,-->
              <!---0.00035348873113075685,-->
              <!--0.0008350374490720339,-->
              <!--0.0019883623292092237,-->
              <!--0.0029851822058659786,-->
              <!--0.0037151107936005253,-->
              <!--0.004090596991872212,-->
              <!--0.004056838019213296,-->
              <!--0.003599313091559949,-->
              <!--0.0027458587411728907,-->
              <!--0.00156828863537558,-->
              <!--0.00017251531182015882,-->
              <!---0.0013052458988603516,-->
              <!---0.002715768456697122,-->
              <!---0.003909987316357709,-->
              <!---0.004753162660433041,-->
              <!---0.005140691893131413,-->
              <!---0.0050106168523310355,-->
              <!---0.004351425337373386,-->
              <!---0.00320543714605933,-->
              <!---0.0016672770415937616,-->
              <!--0.00012312548303690978,-->
              <!--0.0019926785421118813,-->
              <!--0.0037512805661514075,-->
              <!--0.0052104666118196604,-->
              <!--0.0062027759402870294,-->
              <!--0.006599952136409629,-->
              <!--0.006328115863953158,-->
              <!--0.005378216695363527,-->
              <!--0.0038104890379569993,-->
              <!--0.0017521117946181493,-->
              <!---0.000611966776179996,-->
              <!---0.003054577050683293,-->
              <!---0.005326872442261248,-->
              <!---0.007182383269177375,-->
              <!---0.00840190005411208,-->
              <!---0.008817516255873877,-->
              <!---0.00833247804020082,-->
              <!---0.006935655728002711,-->
              <!---0.0047080906670491415,-->
              <!---0.001821004147682756,-->
              <!--0.0014750285279755753,-->
              <!--0.0048695852251225274,-->
              <!--0.008018786893083114,-->
              <!--0.010576670904416401,-->
              <!--0.012229010311942085,-->
              <!--0.012726312630052106,-->
              <!--0.011913015465372833,-->
              <!--0.009750084953949172,-->
              <!--0.006328427271711935,-->
              <!--0.0018713871608465537,-->
              <!---0.003274330887083613,-->
              <!---0.008659220173814952,-->
              <!---0.013761924262459285,-->
              <!---0.018028239553769716,-->
              <!---0.02091524526167527,-->
              <!---0.021937073654634705,-->
              <!---0.020708553290744478,-->
              <!---0.016982856432182784,-->
              <!---0.010679836644011646,-->
              <!---0.0019023206213515946,-->
              <!--0.009061298288252837,-->
              <!--0.021749042124070677,-->
              <!--0.035551187213620855,-->
              <!--0.049748438786416896,-->
              <!--0.06355963790933679,-->
              <!--0.07619535467529986,-->
              <!--0.0869134252019751,-->
              <!--0.09507199046386858,-->
              <!--0.10017589835608541,-->
              <!--0.10191277909810488,-->
              <!--0.10017589835608541,-->
              <!--0.09507199046386858,-->
              <!--0.0869134252019751,-->
              <!--0.07619535467529986,-->
              <!--0.06355963790933679,-->
              <!--0.049748438786416896,-->
              <!--0.035551187213620855,-->
              <!--0.021749042124070677,-->
              <!--0.009061298288252837,-->
              <!---0.0019023206213515946,-->
              <!---0.010679836644011646,-->
              <!---0.016982856432182784,-->
              <!---0.020708553290744478,-->
              <!---0.021937073654634705,-->
              <!---0.02091524526167527,-->
              <!---0.018028239553769716,-->
              <!---0.013761924262459285,-->
              <!---0.008659220173814952,-->
              <!---0.003274330887083613,-->
              <!--0.0018713871608465537,-->
              <!--0.006328427271711935,-->
              <!--0.009750084953949172,-->
              <!--0.011913015465372833,-->
              <!--0.012726312630052106,-->
              <!--0.012229010311942085,-->
              <!--0.010576670904416401,-->
              <!--0.008018786893083114,-->
              <!--0.0048695852251225274,-->
              <!--0.0014750285279755753,-->
              <!---0.001821004147682756,-->
              <!---0.0047080906670491415,-->
              <!---0.006935655728002711,-->
              <!---0.00833247804020082,-->
              <!---0.008817516255873877,-->
              <!---0.00840190005411208,-->
              <!---0.007182383269177375,-->
              <!---0.005326872442261248,-->
              <!---0.003054577050683293,-->
              <!---0.000611966776179996,-->
              <!--0.0017521117946181493,-->
              <!--0.0038104890379569993,-->
              <!--0.005378216695363527,-->
              <!--0.006328115863953158,-->
              <!--0.006599952136409629,-->
              <!--0.0062027759402870294,-->
              <!--0.0052104666118196604,-->
              <!--0.0037512805661514075,-->
              <!--0.0019926785421118813,-->
              <!--0.00012312548303690978,-->
              <!---0.0016672770415937616,-->
              <!---0.00320543714605933,-->
              <!---0.004351425337373386,-->
              <!---0.0050106168523310355,-->
              <!---0.005140691893131413,-->
              <!---0.004753162660433041,-->
              <!---0.003909987316357709,-->
              <!---0.002715768456697122,-->
              <!---0.0013052458988603516,-->
              <!--0.00017251531182015882,-->
              <!--0.00156828863537558,-->
              <!--0.0027458587411728907,-->
              <!--0.003599313091559949,-->
              <!--0.004056838019213296,-->
              <!--0.004090596991872212,-->
              <!--0.0037151107936005253,-->
              <!--0.0029851822058659786,-->
              <!--0.0019883623292092237,-->
              <!--0.0008350374490720339,-->
              <!---0.00035348873113075685,-->
              <!---0.001457466901256732,-->
              <!---0.002370510988411781,-->
              <!---0.0030095937645275247,-->
              <!---0.003322327927713805,-->
              <!---0.003290910916436153,-->
              <!---0.002932483148523807,-->
              <!---0.0022960128396151197,-->
              <!---0.0014561513146110331,-->
              <!---0.0005047827344109434,-->
              <!--0.0004588012857748747,-->
              <!--0.0013380626525659346,-->
              <!--0.0020487184085070985,-->
              <!--0.0025266320478267643,-->
              <!--0.0027334335652668637,-->
              <!--0.002659227732236504,-->
              <!--0.0023226716718390684,-->
              <!--0.001767547736107444,-->
              <!--0.0010581596250525992,-->
              <!--0.00027104240117469723,-->
              <!---0.0005119460903520359,-->
              <!---0.0012129552507598228,-->
              <!---0.001765388035502459,-->
              <!---0.0021198217044335844,-->
              <!---0.002248754931510682,-->
              <!---0.0021483181858475784,-->
              <!---0.0018374950141107622,-->
              <!---0.0013555550703382986,-->
              <!---0.0007574277613441397,-->
              <!---0.00010741899810514048,-->
              <!--0.0005276301064771511,-->
              <!--0.0010849873962094846,-->
              <!--0.0015120845191814007,-->
              <!--0.0017714275483144606,-->
              <!--0.0018437917069870024,-->
              <!--0.0017294122784003922,-->
              <!--0.0014471472454258524,-->
              <!--0.0010318531096450252,-->
              <!--0.000530263492242788,-->
              <!---0.000004117683517692287,-->
              <!---0.0005166635298891603,-->
              <!---0.0009570948220111251,-->
              <!---0.0012844080918280958,-->
              <!---0.0014704848829605447,-->
              <!---0.001502519838363339,-->
              <!---0.0013835406161774187,-->
              <!---0.0011315675163482634,-->
              <!---0.0007771661428218825,-->
              <!---0.000359853623445428,-->
              <!--0.00007615365471434685,-->
              <!--0.0004866247231273881,-->
              <!--0.0008316992518709261,-->
              <!--0.00107966687752577,-->
              <!--0.0012098510520863832,-->
              <!--0.0012141948511847783,-->
              <!--0.001097523416204855,-->
              <!--0.000876549527692335,-->
              <!--0.0005776987863410642,-->
              <!--0.0002340367024979458,-->
              <!---0.00011829244928704584,-->
              <!---0.0004438002524462949,-->
              <!---0.0007112247528434015,-->
              <!---0.0008964319238104276,-->
              <!---0.000984516201245384,-->
              <!---0.0009709220911588188,-->
              <!---0.0008614494227763559,-->
              <!---0.000671195174685452,-->
              <!---0.0004226455151086228,-->
              <!---0.0001431160486873042,-->
              <!--0.00013818365054974588,-->
              <!--0.0003931955899840721,-->
              <!--0.0005977328913941834,-->
              <!--0.0007337176980505024,-->
              <!--0.0007907422624142932,-->
              <!--0.0007667261596272183,-->
              <!--0.0006677718518284225,-->
              <!--0.0005071779965350007,-->
              <!--0.00030375770471739705,-->
              <!--0.0007970942590158282,-->
              <!---0.00014173857730711593,-->
              <!---0.00033870204567137594,-->
              <!---0.000492782263267057,-->
              <!---0.0005907181361403068,-->
              <!---0.0006254774225729954,-->
              <!---0.000596662739632874,-->
              <!---0.0005101995198440321,-->
              <!---0.00037748833859792323,-->
              <!---0.00021396447130023755,-->
              <!---0.00003736705866755851,-->
              <!--0.000134118444828564,-->
              <!--0.00028377644920395877,-->
              <!--0.0003978553057458494,-->
              <!--0.00046685253645557237,-->
              <!--0.00048620463813092815,-->
              <!--0.00045654366766502164,-->
              <!--0.00038335249237054993,-->
              <!--0.00027616232514818777,-->
              <!--0.00014735081764449018,-->
              <!--0.00001079042116774322,-->
              <!---0.0001195808768791947,-->
              <!---0.00023115868498795148,-->
              <!---0.00031392527777645765,-->
              <!---0.0003612784993610939,-->
              <!---0.00037043311961797344,-->
              <!---0.0003425564804803397,-->
              <!---0.0002824911883995296,-->
              <!---0.00019796754416048594,-->
              <!---0.0000986612764118863,-->
              <!--0.000004744521729386702,-->
              <!--0.00010177361824173874,-->
              <!--0.00018326300041398026,-->
              <!--0.00024198428189485562,-->
              <!--0.0002734237861556655,-->
              <!--0.0002761074430862418,-->
              <!--0.00025129530155059066,-->
              <!--0.00020313385543716415,-->
              <!--0.00013762263297549253,-->
              <!--0.00006229625447347436,-->
              <!---0.000014876616646236282,-->
              <!---0.00008613473789343864,-->
              <!---0.00014475102002096062,-->
              <!---0.00018558660380287622,-->
              <!---0.00020550897619134062,-->
              <!---0.00020355076392327846,-->
              <!---0.0001808698805668453,-->
              <!---0.00014049302887877223,-->
              <!---0.00008689923096278177,-->
              <!---0.000025492304236947266,-->
              <!--0.0000379777176409305,-->
              <!--0.00009798874011535673,-->
              <!--0.00014976187493502877,-->
              <!--0.00018966628716712963,-->
              <!--0.00021551617271523216,-->
              <!--0.0002267916698013417,-->
              <!--0.00022490373096952464,-->
              <!--0.0002138443894806364,-->
              <!--0.00020209454836774045,-->
              <!--0.00020805094265219693,-->
              <!--0.00027483101557697744,-->
              <!---0.0001532531869752378-->
              <!--"/>-->
        <!--<fact.utils.ShiftDataArray key="DataFiltered" outputKey="DataFiltered" shift="210"/>-->
<!--  For Open Shutter Data: Slope Extraction Method -->
        <fact.filter.ShapeSignal key="DataCalibrated" outputKey="DataShaped" shift="20"/>

		<fact.statistics.Derivation key="DataSmoothed" outputKey="slopeKey" />
            <fact.features.ArrivalTimeFromSlope key="DataSmoothed" outputKey="ArrivalTimesSlope" derivationKey="slopeKey" visualizeKey="slopeArrivalTimes"
			baselineKey="baselines" skipFirstSlices="50" skipLastSlices="100"/>
            <fact.features.FindMaxSlope key="DataShaped" derivationKey="slopeKey" outputKey="maxSlopes" outputKeyVisualization="maxSlopePos" arrivalTimeKey="ArrivalTimesSlope" maxSearchSlice="30"/>

		<fact.io.JSONWriter url="file:${outfile}" keys="maxSlopes,ArrivalTimesSlope,baselines"/>

            <!--<fact.ShowViewer key="DataShaped"/>-->

	</process>
</container>
