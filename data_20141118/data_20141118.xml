<container>

    <!-- Pfade zu den fits files. -->
    <!-- testDataFile: 20130102_060 -->
    <property name="infile" value="src/test/resources/testDataFile.fits.gz" />
    <property name="drsfile" value="src/test/resources/testDrsFile.drs.fits.gz" />
    <property name="drstimefile" value="src/test/resources/testDrsTimeFile.drs.time.fits" />
    <property name="drivefile" value="src/test/resources/testDriveFile.fits" />
    <property name="integralGainFile" value="/home/fact_opr/facttools/gain_sorted_20131127.csv" />
    <property name="pixelDelayFile" value="/home/fact_opr/facttools/pixel_delays_20141118.csv" />
    <property name="outfile" value="/home/fabian/testoutfile.csv" />
    <property name="sourcename" value="crab" />
    <property name="core_threshold" value="6.0" />
    <property name="neighbor_threshold" value="3.0"/>
    <property name="time_threshold" value="15.0" />
    <property name="min_number_of_pixel" value="2" />
    <property name="start_search_window" value="35" />
    <property name="range_search_window" value="60" />

    <property name="event_param"
        value="NIGHT,RUNID,EventNum,UnixTimeUTC" />
    <property name="tracking_param"
        value="pointingAz_nominal,pointingZd_nominal,pointingAz_calc,pointingZd_calc,sourcePositionAz_calc,sourcePositionZd_calc" />

    <property name="stat_allPix_param"
        value="photonchargeMean,arrivalTimeMean" />
    <property name="stat_phCharge_param"
        value="phChargeShower_mean,phChargeShower_max,phChargeShower_min,phChargeShower_kurtosis,phChargeShower_variance,phChargeShower_skewness" />
    <property name="stat_arrTime_param"
        value="arrTimeShower_mean,arrTimeShower_max,arrTimeShower_min,arrTimeShower_kurtosis,arrTimeShower_variance,arrTimeShower_skewness" />
    <property name="stat_maxSlopes_param"
        value="maxSlopesShower_mean,maxSlopesShower_max,maxSlopesShower_min,maxSlopesShower_kurtosis,maxSlopesShower_variance,maxSlopesShower_skewness" />
    <property name="stat_arrTimePos_param"
        value="arrTimePosShower_mean,arrTimePosShower_max,arrTimePosShower_min,arrTimePosShower_kurtosis,arrTimePosShower_variance,arrTimePosShower_skewness" />
    <property name="stat_maxSlopesPos_param"
        value="maxSlopesPosShower_mean,maxSlopesPosShower_max,maxSlopesPosShower_min,maxSlopesPosShower_kurtosis,maxSlopesPosShower_variance,maxSlopesPosShower_skewness" />
    <property name="stat_maxAmplPos_param"
        value="maxAmplPosShower_mean,maxAmplPosShower_max,maxAmplPosShower_min,maxAmplPosShower_kurtosis,maxAmplPosShower_variance,maxAmplPosShower_skewness" />
    <property name="stat_phChargeSat_param"
        value="phChargeSaturation_mean,phChargeSaturation_max,phChargeSaturation_min,phChargeSaturation_kurtosis,phChargeSaturation_variance,phChargeSaturation_skewness" />
    <property name="stat_arrTimeTOT_param"
        value="arrTimeSaturation_mean,arrTimeSaturation_max,arrTimeSaturation_min,arrTimeSaturation_kurtosis,arrTimeSaturation_variance,arrTimeSaturation_skewness" />

    <property name="shower_param"
        value="numPixelInShower,Size,Length,Width,numIslands,Delta,COGx,COGy,m3l,m3t,M3Long,M3Trans,M4Long,M4Trans,Disp" />
    <property name="conc_param"
        value="Concentration_onePixel,Concentration_twoPixel,ConcCore,concCOG,Leakage,Leakage2" />
    <property name="spread_param"
        value="Slope_long,Slope_trans,Slope_spread,Slope_spread_weighted,Timespread,Timespread_weighted" />
    <property name="time_gradient_param"
        value="timeGradientSlope,timeGradientSlope_err,timeGradientIntercept,timeGradientIntercept_err,timeGradientSSE" />

    <property name="sourcePos"
        value="sourcePosition,antiSourcePosition_1,antiSourcePosition_2,antiSourcePosition_3,antiSourcePosition_4,antiSourcePosition_5" />
    <property name="alpha"
        value="Alpha,Alpha_Off_1,Alpha_Off_2,Alpha_Off_3,Alpha_Off_4,Alpha_Off_5" />
    <property name="distance"
        value="Distance,Distance_Off_1,Distance_Off_2,Distance_Off_3,Distance_Off_4,Distance_Off_5" />
    <property name="cosdeltaalpha"
        value="CosDeltaAlpha,CosDeltaAlpha_Off_1,CosDeltaAlpha_Off_2,CosDeltaAlpha_Off_3,CosDeltaAlpha_Off_4,CosDeltaAlpha_Off_5" />
    <property name="theta"
        value="Theta,Theta_Off_1,Theta_Off_2,Theta_Off_3,Theta_Off_4,Theta_Off_5,Theta_recPos,Theta_Off_1_recPos,Theta_Off_2_recPos,Theta_Off_3_recPos,Theta_Off_4_recPos,Theta_Off_5_recPos" />

    <property name="keysForOutput"
        value="${event_param},${tracking_param},${stat_allPix_param},${stat_phCharge_param},${stat_arrTime_param},${stat_maxSlopes_param},${stat_arrTimePos_param},${stat_maxSlopesPos_param},${stat_maxAmplPos_param},${stat_phChargeSat_param},${stat_arrTimeTOT_param},${shower_param},${conc_param},${spread_param},${time_gradient_param},${sourcePos},${alpha},${distance},${cosdeltaalpha},${theta}" />

    <stream id="fact" class="fact.io.FitsStream"  url="file:${infile}"/>

    <process id="2" input="fact">
        <!-- Calibration: -->
        <!-- PreviousEventInfo, DrsCalibration, PatchJumpRemoval, RemoveSpikes,
        DrsTimeCalibration, ArrayTimeCorrection, InterpolateBadPixel -->
        <include file="data_20141118/calibration.xml" />
        <!-- Output: DataCalibrated -->

        <!-- Extraction and cleaning -->
        <!-- BasicExtraction, RisingEdgeForPositions, RisingEdgePolynomFit, TimeOverThreshold,
        PhotonChargeTimeOverThreshold, HandleSaturation, CorrectPixelDelays,
        SourcePosition(Cetatauri), CoreNeighborCleanTimeNeighbor, Size, DistributionFormShower,
        TimeGradient,
        TimeGradientExtraction, RisingEdgeForPositions, RisingEdgePolynomFit, HandleSaturation, 
        CorrectPixelDelays, CoreNeighborCleanTimeNeighbor -->
        <include file="data_20141118/extractCleaning.xml" />     
        <!-- Output: photoncharge, arrivalTime, shower -->   
        
        <!-- Parameter calculation (only source independent) -->
        <!-- ArrayMean(photoncharge,arrivalTime), ArrayStatistics(photoncharge,arrivalTime,maxSlopes,
        arrivalTimePos,maxSlopesPos,maxAmplitudePosition,photonchargeSaturated,arrivalTimeTOT), 
        Size, DistributionFromShower, M3Long, Length, Width, NumberOfIslands, TimeGraident,
        Concentration, ConcentrationCore, ConcentrationAtCenterOfGravity, Leakage, TimeSpread,
        ShowerSlope, Disp -->
        <include file="data_20141118/parameterCalc.xml" /> 
        <!-- Output: source independent parameters -->   

        <!-- Parameter calculation (only source dependent) -->
        <!-- SourcePosition(${sourcename}), AntiSourcePosition(5), Alpha(for 6 Sources),
        Distance(for 6 Sources), CosDeltaAlpha(for 6 Sources), Theta(for 6 Sources) -->
        <include file="data_20141118/sourceParameter.xml" /> 
        <!-- Output: source dependent parameters -->
        

        <fact.io.RootASCIIWriter url="file:${outfile}" keys="${keysForOutput}" />

    </process>


</container>
