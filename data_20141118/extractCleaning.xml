<fact.extraction.BasicExtraction
    dataKey="DataCalibrated" 
    outputKeyMaxAmplPos="maxAmplitudePosition"
    outputKeyPhotonCharge="photoncharge" 
    url="file:${integralGainFile}"
    startSearchWindow="${start_search_window}"
    rangeSearchWindow="${range_search_window}"
    rangeHalfHeightWindow="25"
/>
<fact.extraction.RisingEdgeForPositions
    dataKey="DataCalibrated"
    amplitudePositionsKey="maxAmplitudePosition"
    outputKey="arrivalTimePos"
    maxSlopesKey="maxSlopesPos"
/>
<fact.extraction.RisingEdgePolynomFit
    dataKey="DataCalibrated"
    risingEdgeKey="arrivalTimePos"
    outputKey="arrivalTime"
    range="5"
    maxSlopesKey="maxSlopes"
/>

<fact.extraction.TimeOverThreshold
    dataKey="DataCalibrated"
    outputKey="timeOverThreshold"
    firstSliceOverThresholdOutputKey="arrivalTimeTOT"
    positionsKey="maxAmplitudePosition"
    threshold="1500" 
    thresholdOutputKey="thresholdForToT"
/>
<fact.extraction.PhotonChargeTimeOverThreshold
    timeOverThresholdKey="timeOverThreshold"
    thresholdKey="thresholdForToT"
    outputKey="photonchargeSaturated"
/>
<fact.extraction.HandleSaturation
    photonChargeKey="photoncharge"
    photonChargeSaturatedKey="photonchargeSaturated"
    arrivalTimeKey="arrivalTime"
    arrivalTimeSaturatedKey="arrivalTimeTOT" 
    limitForSaturatedPixel="150" 
    outputKeyPhotonCharge="photoncharge" 
    outputKeyArrivalTime="arrivalTime" 
    saturatedPixelKey="saturatedPixel" 
/>
<fact.datacorrection.CorrectPixelDelays
    arrivalTimeKey="arrivalTime"
    outputKey="arrivalTime"
    url="file:{pixelDelayFile}"
/>
<fact.features.source.SourcePosition
    outputKey="Cetatauri"
    url="file:${drivefile}"
    sourceRightAscension="84.41125"
    sourceDeclination="21.1425"
/>
<fact.cleaning.CoreNeighborCleanTimeNeighbor
    photonChargeKey="photoncharge"
    outputKey="shower"
    arrivalTimeKey="arrivalTime" 
    corePixelThreshold="${core_threshold}"
    neighborPixelThreshold="${neighbor_threshold}"
    timeThreshold="${time_threshold}"
    minNumberOfPixel="${min_number_of_pixel}"
    starPositionKeys="Cetatauri"
    starRadiusInCamera="11.0"
    showDifferentCleaningSets="false"
/>
   
<Skip condition="%{data.shower} == null" />

<fact.features.NumberOfPixelInShower 
    showerKey="shower"
    outputKey="numPixelInShower"
/>
    
<Skip condition="%{data.numPixelInShower} &lt; 3" />
<fact.features.Size
    showerKey="shower"
    photonChargeKey="photoncharge"
    outputKey="Size"
/>
<fact.features.DistributionFromShower
    weightsKey="photoncharge"
    showerKey="shower"
    sizeKey="Size"
    outputKey="showerDistribution"
/>
<fact.features.TimeGradient
    showerKey="shower"
    arrivalTimeKey="arrivalTime"
    cogxKey="COGx"
    cogyKey="COGy"
    deltaKey="Delta"
    outputKeySlope="timeGradientSlope"
    outputKeyIntercept="timeGradientIntercept"
    outputKeySumSquaredErrors="timeGradientSSE"
/>

<fact.extraction.TimeGradientExtraction
    dataKey="DataCalibrated" 
    outputKeyMaxAmplPos="maxAmplitudePosition"
    outputKeyPhotonCharge="photoncharge" 
    url="file:${integralGainFile}"
    rangeSearchWindow="30"
    rangeHalfHeightWindow="25"
    deltaKey="Delta"
    cogxKey="COGx"
    cogyKey="COGy"
    timeGradientSlopeKey="timeGradientSlope"
    timeGradientInterceptKey="timeGradientIntercept"
/>
<fact.extraction.RisingEdgeForPositions
    dataKey="DataCalibrated"
    amplitudePositionsKey="maxAmplitudePosition"
    outputKey="arrivalTimePos"
    maxSlopesKey="maxSlopesPos"
/>
<fact.extraction.RisingEdgePolynomFit
    dataKey="DataCalibrated"
    risingEdgeKey="arrivalTimePos"
    outputKey="arrivalTime"
    range="5"
    maxSlopesKey="maxSlopes"
/>
<fact.extraction.TimeOverThreshold
    dataKey="DataCalibrated"
    outputKey="timeOverThreshold"
    firstSliceOverThresholdOutputKey="arrivalTimeTOT"
    positionsKey="maxAmplitudePosition"
    threshold="1500" 
    thresholdOutputKey="thresholdForToT"
/>
<fact.extraction.PhotonChargeTimeOverThreshold
    timeOverThresholdKey="timeOverThreshold"
    thresholdKey="thresholdForToT"
    outputKey="photonchargeSaturated"
/>
<fact.extraction.HandleSaturation
    photonChargeKey="photoncharge"
    photonChargeSaturatedKey="photonchargeSaturated"
    arrivalTimeKey="arrivalTime"
    arrivalTimeSaturatedKey="arrivalTimeTOT" 
    limitForSaturatedPixel="150" 
    outputKeyPhotonCharge="photoncharge" 
    outputKeyArrivalTime="arrivalTime" 
    saturatedPixelKey="saturatedPixel" 
/>
<fact.datacorrection.CorrectPixelDelays
    arrivalTimeKey="arrivalTime"
    outputKey="arrivalTime"
    url="file:{pixelDelayFile}"
/>
<fact.cleaning.CoreNeighborCleanTimeNeighbor
    photonChargeKey="photoncharge"
    outputKey="shower"
    arrivalTimeKey="arrivalTime" 
    corePixelThreshold="${core_threshold}"
    neighborPixelThreshold="${neighbor_threshold}"
    timeThreshold="${time_threshold}"
    minNumberOfPixel="${min_number_of_pixel}"
    starPositionKeys="Cetatauri"
    starRadiusInCamera="11.0"
    showDifferentCleaningSets="false"
/>