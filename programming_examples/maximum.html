<!DOCTYPE html>
<!--
 | Generated by Apache Maven Doxia Site Renderer 1.8 at 2019-10-17 
 | Rendered using Apache Maven Fluido Skin 1.6
-->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="Date-Revision-yyyymmdd" content="20191017" />
    <meta http-equiv="Content-Language" content="en" />
    <title>Fact Tools &#x2013; Find the maximum slice</title>
    <link rel="stylesheet" href="../css/apache-maven-fluido-1.6.min.css" />
    <link rel="stylesheet" href="../css/site.css" />
    <link rel="stylesheet" href="../css/print.css" media="print" />
      <script type="text/javascript" src="../js/apache-maven-fluido-1.6.min.js"></script>
      </head>
    <body class="topBarDisabled">
      <div class="container-fluid">
      <div id="banner">
        <div class="pull-left"><a href="http://www.uni-dortmund.de/" id="bannerLeft"><img src="../images/logo_tu.png"  alt="tu logo"/></a></div>
        <div class="pull-right"><a href="../" id="bannerRight"><img src="../images/header-bg-topLeft.png"  alt="ls8 logo"/></a></div>
        <div class="clear"><hr/></div>
      </div>

      <div id="breadcrumbs">
        <ul class="breadcrumb">
        <li id="publishDate">Last Published: 2019-10-17<span class="divider">|</span>
</li>
          <li id="projectVersion">Version: 1.1.3</li>
        </ul>
      </div>
      <div class="row-fluid">
        <div id="leftColumn" class="span2">
          <div class="well sidebar-nav">
<ul class="nav nav-list">
            <li class="nav-header">General</li>
    <li><a href="../index.html" title="Overview"><span class="none"></span>Overview</a>  </li>
    <li><a href="../publications.html" title="Publications"><span class="none"></span>Publications</a>  </li>
    <li><a href="../viewer.html" title="Fact Viewer"><span class="none"></span>Fact Viewer</a>  </li>
    <li><a href="../build.html" title="Building"><span class="none"></span>Building</a>  </li>
          <li class="nav-header">Tutorial</li>
    <li><a href="../tutorial/index.html" title="FACT Tools Tutorial"><span class="icon-chevron-right"></span>FACT Tools Tutorial</a>  </li>
          <li class="nav-header">Documentation</li>
    <li><a href="../quickstart.html" title="Quickstart"><span class="none"></span>Quickstart</a>  </li>
    <li><a href="../multistream.html" title="Using Multistreams"><span class="none"></span>Using Multistreams</a>  </li>
    <li><a href="../aux.html" title="Using Auxiliary Data"><span class="none"></span>Using Auxiliary Data</a>  </li>
    <li><a href="../stdAnalysis/standardAnalysis.html" title="Standard Analysis"><span class="icon-chevron-down"></span>Standard Analysis</a>
      <ul class="nav nav-list">
    <li><a href="../stdAnalysis/standardSettings.html" title="Standard Settings"><span class="none"></span>Standard Settings</a>  </li>
      </ul>
  </li>
    <li><a href="../examples.html" title="Usage Examples"><span class="icon-chevron-down"></span>Usage Examples</a>
      <ul class="nav nav-list">
    <li><a href="../example_writing.html" title="Reading and Writing Data"><span class="none"></span>Reading and Writing Data</a>  </li>
    <li><a href="../plotting/example_plots.html" title="Plotting Data"><span class="icon-chevron-right"></span>Plotting Data</a>  </li>
      </ul>
  </li>
    <li><a href="../programming_examples/programming_example.html" title="Programming Examples"><span class="icon-chevron-down"></span>Programming Examples</a>
      <ul class="nav nav-list">
    <li><a href="../programming_examples/displaying.html" title="Displaying data in the Viewer"><span class="none"></span>Displaying data in the Viewer</a>  </li>
    <li><a href="../programming_examples/colormaps.html" title="Creating custom color maps"><span class="none"></span>Creating custom color maps</a>  </li>
    <li class="active"><a href="#"><span class="none"></span>Finding the maximum</a>
  </li>
    <li><a href="../programming_examples/parameter.html" title="Passing parameters from the .xml"><span class="none"></span>Passing parameters from the .xml</a>  </li>
    <li><a href="../programming_examples/logging.html" title="Log output"><span class="none"></span>Log output</a>  </li>
      </ul>
  </li>
    <li><a href="../resources.html" title="Further Resources"><span class="none"></span>Further Resources</a>  </li>
          <li class="nav-header">Download</li>
    <li><a href="../download.html" title="Download"><span class="none"></span>Download</a>  </li>
          <li class="nav-header">Project Documentation</li>
    <li><a href="../project-info.html" title="Project Information"><span class="icon-chevron-right"></span>Project Information</a>  </li>
    <li><a href="../project-reports.html" title="Project Reports"><span class="icon-chevron-right"></span>Project Reports</a>  </li>
  </ul>
          <hr />
          <div id="poweredBy">
              <div class="clear"></div>
              <div class="clear"></div>
              <div class="clear"></div>
              <div class="clear"></div>
  <a href="http://maven.apache.org/" title="Built by Maven" class="poweredBy"><img class="builtBy" alt="Built by Maven" src="../images/logos/maven-feather.png" /></a>
              </div>
          </div>
        </div>
        <div id="bodyColumn"  class="span10" >
<h1>Find the maximum slice</h1>
<p>This processor simply iterates over all slices in each pixel and stores the maximum amplitude of all pixels. At first we need to get the actual telescope data from the input. The data is stored in one large 1D array of constant length. Once the maximum is found we put it back into the input. Now heres the catch. Since you can only store things of type <tt>Serializable</tt> into the map we cannot use a primitive <tt>double</tt> variable but the corresponding <tt>Double</tt> object.</p>

<div>
<div>
<pre class="source">    package fact.features;

    //imports ...

    /**
     * Documentation goes here
     */
    public class MaxAmp implements Processor {

      private String key = &quot;DataCalibrated&quot;;
      private String outputKey = &quot;maximum_amplitude;

      @Override
      public Data process(Data item) {
        // get the data from the input
        double[] data = (double[]) input.get(key);
        // here we save the amplitude
        Double maxAmplitude = 0;

        //get the roi. The Region of interest. Thats the length of an event in slices
        int roi = (Integer) input.get(&quot;NROI&quot;);
        
        
        // for each pixel
        for(int pix = 0 ; pix &lt; Constants.NUMBEROFPIXELS; pix++){
          //get the position of the first slice of pixel pix in the 1D array.
          int position = pix*roi;
          //iterate over all slices
          for(int slice = position; slice &lt; position + roi; slice ++){
            //and find the maximum
            if(data[slice] &gt; maxAmplitude){
              maxAmplitude = data[slice]
            }
          }
        }

        //now we save the amplitude under the name outputKey in the map and return the input
        input.put(outputKey, maxAmplitude)
      }
    }
</pre></div></div>

<p>We use two loops here to exemplify how to iterate over each pixel separately event though this could easily be accomplished in a single loop. Another way to make this a bit quicker would be to store the maximum amplitude in a primitive double and then cast it to a <tt>Double</tt> before storing it in the map. You can read <a class="externalLink" href="http://stackoverflow.com/questions/5199359/why-do-people-still-use-primitive-types-in-java">this</a> discussion on the primitive types vs Number Objects in the Java programming language.</p>
<p>If you don&#x2019;t worry about runtime and memory consumption you can also iterate over the pixel data by using the methods provided by the FactPixelMap singelton.</p>

<div>
<div>
<pre class="source">        int roi = (Integer) input.get(&quot;NROI&quot;);
        for (FactCameraPixel p : map.pixelArray){
            double[] pixelData = p.getPixelData(data, roi);
        }
</pre></div></div>

<p>This creates a copy of the data for the specified pixel.</p>
        </div>
      </div>
    </div>
    <hr/>
    <footer>
      <div class="container-fluid">
        <div class="row-fluid">
            <p>Copyright &copy;2019.
All rights reserved.</p>
        </div>
        </div>
    </footer>
    </body>
</html>
