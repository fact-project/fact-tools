<container xmlns:ui="http://www.jwall.org/streams/dashboard.xsd">

    <property name="datafile" value="/Users/chris/Downloads/20111126_042.fits" />
    <property name="drsfile" value="src/test/resources/testDrsFile.drs.fits.gz" />
    

    <service id="dashboard" class="fact.demo.FACTDashboard"  size="1440,1024" location="0,0">
        
        <fact.demo.widgets.Camera id="camera"  title="Camera" radius="3.5" delay="15ms" ui:location="20,110" ui:size="260,270" play="false"/>
        
        <fact.demo.widgets.DataFlow id="dataflow" title="Streaming Process" config="classpath:/fact-tools-demo.xml" ui:location="110,450" ui:size="1168,300" />
        
        <fact.demo.widgets.CameraOverlay id="camera:shower"  title="Shower" radius="3.5" delay="15ms" ui:location="320,110" ui:size="260,270"/>
        
        <Table id="features" title="Extracted Features" keys="EventNum,COGx,COGy,Length,Width" ui:location="620,110" ui:size="800,270" />
        
    </service>
    
    
    <stream id="data" class="fact.io.FitsStream" url="file:${datafile}"/>
    
    <process input="data">
        
        <stream.flow.Skip condition="%{data.TriggerType} != 4" />

        <fact.filter.DrsCalibration url="file:${drsfile}" key="Data"  outputKey="DataCalibrated"/>

        <fact.demo.UpdateWidget dashboard="dashboard" widget="camera" />
        
		<fact.ShowViewer key="DataCalibrated"/>

        <!--<fact.demo.UpdateWidget dashboard="dashboard" widget="camera" />-->

        <fact.extraction.MaxAmplitudePosition key="DataCalibrated" searchWindowLeft="25" searchWindowRight="125" outputKey="maxAmplitudePosition"/>
        <fact.extraction.PhotonCharge dataKey="DataCalibrated" rangeSearchWindow="25"
                                      url="file:src/main/resources/gain_sorted_20131127.csv" positions="maxAmplitudePosition"
                                      outputKey="photoncharge"/>

        <fact.cleaning.CoreNeighborClean photonChargeKey="photoncharge" outputKey="shower" corePixelThreshold="5" neighborPixelThreshold="2"
                                         arrivalTimeKey="maxAmplitudePosition" timeThreshold="30"  minNumberOfPixel="2"/>
        
        <fact.features.DistributionFromShower weightsKey="photoncharge" showerKey="shower" outputKey="dist" />
        

        <PrintData/>
        <stream.flow.Skip condition="%{data.shower} == null" />
        
        <fact.demo.UpdateWidget dashboard="dashboard" widget="camera:shower" />
        
        <!--<fact.features.DistributionFromShower weightsKey="photoncharge" showerKey="shower" outputKey="dist" />-->
        <fact.demo.UpdateWidget dashboard="dashboard" widget="features" />


    </process>
    
</container>
