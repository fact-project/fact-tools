<!DOCTYPE html>
<!--
 | Generated by Apache Maven Doxia Site Renderer 1.8 at 2019-10-17 
 | Rendered using Apache Maven Fluido Skin 1.6
-->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="Date-Revision-yyyymmdd" content="20191017" />
    <meta http-equiv="Content-Language" content="en" />
    <title>Fact Tools &#x2013; Performing a Standard Analysis</title>
    <link rel="stylesheet" href="../css/apache-maven-fluido-1.6.min.css" />
    <link rel="stylesheet" href="../css/site.css" />
    <link rel="stylesheet" href="../css/print.css" media="print" />
      <script type="text/javascript" src="../js/apache-maven-fluido-1.6.min.js"></script>
      </head>
    <body class="topBarDisabled">
      <div class="container-fluid">
      <div id="banner">
        <div class="pull-left"><a href="http://www.uni-dortmund.de/" id="bannerLeft"><img src="../images/logo_tu.png"  alt="tu logo"/></a></div>
        <div class="pull-right"><a href="../" id="bannerRight"><img src="../images/header-bg-topLeft.png"  alt="ls8 logo"/></a></div>
        <div class="clear"><hr/></div>
      </div>

      <div id="breadcrumbs">
        <ul class="breadcrumb">
        <li id="publishDate">Last Published: 2019-10-17<span class="divider">|</span>
</li>
          <li id="projectVersion">Version: 1.1.3</li>
        </ul>
      </div>
      <div class="row-fluid">
        <div id="leftColumn" class="span2">
          <div class="well sidebar-nav">
<ul class="nav nav-list">
            <li class="nav-header">General</li>
    <li><a href="../index.html" title="Overview"><span class="none"></span>Overview</a>  </li>
    <li><a href="../publications.html" title="Publications"><span class="none"></span>Publications</a>  </li>
    <li><a href="../viewer.html" title="Fact Viewer"><span class="none"></span>Fact Viewer</a>  </li>
    <li><a href="../build.html" title="Building"><span class="none"></span>Building</a>  </li>
          <li class="nav-header">Tutorial</li>
    <li><a href="../tutorial/index.html" title="FACT Tools Tutorial"><span class="icon-chevron-right"></span>FACT Tools Tutorial</a>  </li>
          <li class="nav-header">Documentation</li>
    <li><a href="../quickstart.html" title="Quickstart"><span class="none"></span>Quickstart</a>  </li>
    <li><a href="../multistream.html" title="Using Multistreams"><span class="none"></span>Using Multistreams</a>  </li>
    <li><a href="../aux.html" title="Using Auxiliary Data"><span class="none"></span>Using Auxiliary Data</a>  </li>
    <li class="active"><a href="#"><span class="icon-chevron-down"></span>Standard Analysis</a>

      <ul class="nav nav-list">
    <li><a href="../stdAnalysis/standardSettings.html" title="Standard Settings"><span class="none"></span>Standard Settings</a>  </li>
      </ul>
  </li>
    <li><a href="../examples.html" title="Usage Examples"><span class="icon-chevron-down"></span>Usage Examples</a>
      <ul class="nav nav-list">
    <li><a href="../example_writing.html" title="Reading and Writing Data"><span class="none"></span>Reading and Writing Data</a>  </li>
    <li><a href="../plotting/example_plots.html" title="Plotting Data"><span class="icon-chevron-right"></span>Plotting Data</a>  </li>
      </ul>
  </li>
    <li><a href="../programming_examples/programming_example.html" title="Programming Examples"><span class="icon-chevron-right"></span>Programming Examples</a>  </li>
    <li><a href="../resources.html" title="Further Resources"><span class="none"></span>Further Resources</a>  </li>
          <li class="nav-header">Download</li>
    <li><a href="../download.html" title="Download"><span class="none"></span>Download</a>  </li>
          <li class="nav-header">Project Documentation</li>
    <li><a href="../project-info.html" title="Project Information"><span class="icon-chevron-right"></span>Project Information</a>  </li>
    <li><a href="../project-reports.html" title="Project Reports"><span class="icon-chevron-right"></span>Project Reports</a>  </li>
  </ul>
          <hr />
          <div id="poweredBy">
              <div class="clear"></div>
              <div class="clear"></div>
              <div class="clear"></div>
              <div class="clear"></div>
  <a href="http://maven.apache.org/" title="Built by Maven" class="poweredBy"><img class="builtBy" alt="Built by Maven" src="../images/logos/maven-feather.png" /></a>
              </div>
          </div>
        </div>
        <div id="bodyColumn"  class="span10" >
<h1>Performing a Standard Analysis</h1>
<p>The standard analysis is meant to analyse raw data files (either from the telescope, called &#x201c;observations&#x201d;, or from MC Simulations, called &#x201c;simulations&#x201d;) to identify and parametrize images of air showers. The calculated parameters can be used used afterwards to perform the gamma-hadron classification, energy reconstruction, and the directional reconstruction.</p>
<p>Besides the effort to make the simulations as similiar as possible to the observations, here are still some differences that need special treatment. To do this, the <tt>CREATOR</tt> FITS Header tag is checked and if it contains <tt>Ceres</tt>, simulations are assumed, else observations.</p>
<div class="section">
<h2><a name="Standard_Analysis_xml_File"></a>Standard Analysis xml File</h2>
<p>The standard analysis xml files is:</p>
<ul>

<li><tt>examples/stdAnalysis.xml</tt></li>
</ul>
<p>The upper part defines the pathes to the different input files (raw data file, drs file, aux directory, gains, pixel delays) and the url to the <a href="./standardSettings.html">default settings</a> files (settings.properties). Than the stream and the process are defined.</p>
<p>These files need to be set differently for observations and simulations.</p>
<p>For simulations, use the provided drs, gain and delay files:</p>

<div>
<div>
<pre class="source">&lt;property name=&quot;drsfile&quot; value=&quot;file:src/main/resources/testMcDrsFile.drs.fits.gz&quot;/&gt;
&lt;property name=&quot;integralGainFile&quot; value=&quot;classpath:/default/defaultIntegralGains.csv&quot;/&gt;
&lt;property name=&quot;pixelDelayFile&quot; value=&quot;classpath:/default/delays_zero.csv&quot;/&gt;
</pre></div></div>

<p>For observations use the appropriate drs file, usually the one taken direcly before the observation you want to analyse, and the provided gain and delay files:</p>

<div>
<div>
<pre class="source">&lt;property name=&quot;drsfile&quot; value=&quot;file:/path/to/drs/file&quot;/&gt;
&lt;property name=&quot;integralGainFile&quot; value=&quot;classpath:/default/gain_sorted_20131127.csv&quot; /&gt;
&lt;property name=&quot;pixelDelayFile&quot; value=&quot;classpath:/default/delays_lightpulser_20150217.csv&quot; /&gt;
</pre></div></div>

<p>The process contains 6 different steps, each contained in a module xml file, which can be found in the classpath and is thus included in the jar. The classpath is <tt>src/main/resources/...</tt> in the repository and you can use <tt>classpath:/...</tt> to access it in the xml.</p>
<p>The analysis modules are the same for simulations and observations and contain control flow based on the <tt>CREATOR</tt> FITS header tag to perform the necessary steps, which are different for simulations and observations.</p>
<p>The analysis results are stored to FITS with the outputkeys determined from the settings.properties file and whether the analyzed file containes observations or simulations.</p>
<div class="section">
<div class="section">
<h4><a name="analysis.2Finit.xml"></a><tt>analysis/init.xml</tt></h4>
<p>For both:</p>
<ul>

<li>The total ratio of saturated slices on the raw timeseries data (the adc values) is calculated, this is useful to skip 27s Events induced by our defective light pulser.</li>
</ul>
<p>Only for observations:</p>
<ul>

<li>The startcell information are stored for the processing of the following events</li>
<li>The <tt>UnixTimeUTC</tt> tuple is converted to a timestamp</li>
</ul></div>
<div class="section">
<h4><a name="analysis.2Fcalibration.xml"></a><tt>analysis/calibration.xml</tt></h4>
<p>For both:</p>
<ul>

<li>DRS amplitude calibration</li>
<li>Spike removal</li>
<li>Interpolation of broken pixels</li>
</ul>
<p>Only for simulations:</p>
<ul>

<li>All keys for which it is necessary are remapped from softID order to chid order.</li>
</ul>
<p>Only for observations:</p>
<ul>

<li>DRS time calibration</li>
<li>Jump removal</li>
</ul></div>
<div class="section">
<h4><a name="analysis.2Fextraction.xml"></a><tt>analysis/extraction.xml</tt></h4>
<p>For both:</p>
<ul>

<li>Estimation of the number of cherenkov photons per pixel and their arrival times.</li>
<li>Handling of saturated  pixels</li>
<li>Interpolation of broken pixels for number of cherenkov photons and arrival times.</li>
</ul></div>
<div class="section">
<h4><a name="analysis.2Fcleaning.xml"></a><tt>analysis/cleaning.xml</tt></h4>
<p>Only for observations:</p>
<ul>

<li>TwoLevelTimeNeighbor cleaning taking Ceta Tauri into account</li>
</ul>
<p>Only for simulations:</p>
<ul>

<li>TwoLevelTimeNeighbor cleaning</li>
</ul>
<p>For both:</p>
<ul>

<li>The number of pixels after the cleaning is calculated</li>
</ul></div>
<div class="section">
<h4><a name="analysis.2FimageParameters.xml"></a><tt>analysis/imageParameters.xml</tt></h4>
<p>For both:</p>
<ul>

<li>All source independent parameters are calculated</li>
</ul></div>
<div class="section">
<h4><a name="analysis.2FsourceDependentParameters.xml"></a><tt>analysis/sourceDependentParameters.xml</tt></h4>
<p>This file is not used in the standard analysis, but can be used to calculate the source depentent parameters (e.g. alpha, disp, theta) and to perforn a rudimentary source position estimation. It is advised to not uses this and use the higher level machine learning tools provided in the <a class="externalLink" href="https://github.com/fact-project/classifier-tools">classifier-tools</a>.</p></div></div></div>
<div class="section">
<h2><a name="Differences_between_observed_and_simulated_data"></a>Differences between observed and simulated data</h2>
<ul>

<li>no timestamp is available for simulated data</li>
<li>some keys have to be remapped from softID to chid order</li>
<li>No jump removal or drs time calibration is applied for simulations</li>
<li>the source position is not taken from auxiliary files, but from columns in the mc-fits files</li>
<li>different sets of output keys are provided, the simulations contain additional simulation truths, the observations addiotional meta data.</li>
</ul></div>
<div class="section">
<h2><a name="Customized_Analysis"></a>Customized Analysis</h2>
<p>If you want to customize your analysis (for example change settings) you can start with the standard analysis files and extend them. You can overwrite every property read from the settings.properties file by writing a <tt>&lt;property name=&quot;name&quot; value=&quot;value&quot; /&gt;</tt>  line behind the <tt>&lt;properties url=&quot;classpath:/default/settings.properties&quot; /&gt;</tt> line.</p>
<p>For example changing the cleaning level:</p>

<div>
<div>
<pre class="source">[...]
&lt;properties url=&quot;classpath:/default/settings_mc.properties&quot; /&gt;

&lt;property name=&quot;TwoLevelTimeNeighbor.coreThreshold&quot; value=&quot;5.0&quot; /&gt;
&lt;property name=&quot;TwoLevelTimeNeighbor.neighborThreshold&quot; value=&quot;2.5&quot; /&gt;
&lt;property name=&quot;TwoLevelTimeNeighbor.timeLimit&quot; value=&quot;10&quot; /&gt;
&lt;property name=&quot;TwoLevelTimeNeighbor.minNumberOfPixel&quot; value=&quot;2&quot; /&gt;
[...]
</pre></div></div>

<p>You can also add own your processors to the process  (for example new parameter calculations):</p>

<div>
<div>
<pre class="source">[...]
&lt;include url=&quot;classpath:/analysis/imageParameters.xml&quot; /&gt; 
&lt;fact.features.NewAwesomeParameter showerKey=&quot;shower&quot; outputKey=&quot;awesomeParameter&quot; /&gt;
[...]
</pre></div></div>
</div>
<div class="section">
<h2><a name="Using_only_single_Steps_of_the_Standard_Analysis"></a>Using only single Steps of the Standard Analysis</h2>
<p>If you want to use only single steps of the standard analysis chain in your own xml file, you can just include the different xml files from the classpath:</p>

<div>
<div>
<pre class="source">&lt;include url=&quot;classpath:/analysis/calibration.xml&quot; /&gt;
</pre></div></div>

<p>You need to consider only some points:</p>
<ul>

<li>You have to include all xml files up to the one you want to use (so cleaning.xml needs extraction.xml, calibration.xml, init.xml)</li>
<li>You have to read in the properties file:

</li>
<li>

<p>the different xml files have some dependency on properties:</p>
</li>
<li>calibration.xml: property <tt>drsfile</tt> and service <tt>calibService</tt> set</li>
<li>extraction.xml: properties <tt>integralGainFile</tt> and <tt>pixelDelayFile</tt> set as well as the <tt>calibService</tt></li>
<li>cleaning.xml: <a href="../aux.html">AuxService</a> has to be set</li>
<li>sourceDependentParameters.xml: <a href="../aux.html">AuxService</a></li>
</ul></div>
        </div>
      </div>
    </div>
    <hr/>
    <footer>
      <div class="container-fluid">
        <div class="row-fluid">
            <p>Copyright &copy;2019.
All rights reserved.</p>
        </div>
        </div>
    </footer>
    </body>
</html>
